<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gesti√≥n de Bodega</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --info: #4895ef;
            --warning: #f72585;
            --danger: #ff4d6d;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #495057;
            --gray-light: #e9ecef;

            --header-height: 60px;
            --sidebar-width: 260px;
            --border-radius: 10px;
            --box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            --transition: all 0.3s ease;

            --font-primary: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            font-size: 0.95rem;
            line-height: 1.6;
            color: var(--dark);
            background-color: #f5f7fb;
            overflow-x: hidden;
        }

        /* SCROLLBAR */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--gray-light);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        /* LOADER */
        .loader-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loader {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            position: relative;
            animation: rotate 1s linear infinite;
        }

        .loader::before {
            content: "";
            box-sizing: border-box;
            position: absolute;
            inset: 0px;
            border-radius: 50%;
            border: 5px solid var(--primary);
            animation: prixClipFix 2s linear infinite;
        }

        @keyframes rotate {
            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes prixClipFix {
            0% {
                clip-path: polygon(50% 50%, 0 0, 0 0, 0 0, 0 0, 0 0);
            }

            25% {
                clip-path: polygon(50% 50%, 0 0, 100% 0, 100% 0, 100% 0, 100% 0);
            }

            50% {
                clip-path: polygon(50% 50%, 0 0, 100% 0, 100% 100%, 100% 100%, 100% 100%);
            }

            75% {
                clip-path: polygon(50% 50%, 0 0, 100% 0, 100% 100%, 0 100%, 0 100%);
            }

            100% {
                clip-path: polygon(50% 50%, 0 0, 100% 0, 100% 100%, 0 100%, 0 0);
            }
        }

        /* LOGIN */
        .login-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9990;
        }

        .login-card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            width: 400px;
            max-width: 90%;
            padding: 30px;
            animation: slideUpFade 0.5s ease forwards;
        }

        @keyframes slideUpFade {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .login-header h1 {
            font-size: 1.8rem;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .login-header p {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .login-form .form-group {
            margin-bottom: 15px;
        }

        .login-form label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--dark);
            font-size: 0.85rem;
        }

        .login-form input,
        .login-form select {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--gray-light);
            border-radius: 5px;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .login-form input:focus,
        .login-form select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .login-form .login-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px;
            width: 100%;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
        }

        .login-form .login-btn:hover {
            background-color: var(--primary-dark);
        }

        .login-divider {
            text-align: center;
            margin: 20px 0;
            position: relative;
        }

        .login-divider:before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background-color: var(--gray-light);
        }

        .login-divider span {
            position: relative;
            background-color: white;
            padding: 0 10px;
            color: var(--gray);
            font-size: 0.8rem;
        }

        .google-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: white;
            border: 1px solid var(--gray-light);
            padding: 12px;
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
        }

        .google-btn:hover {
            background-color: var(--gray-light);
        }

        .google-btn img {
            width: 20px;
            margin-right: 10px;
        }

        .google-btn span {
            font-weight: 600;
            color: var(--dark);
        }

        /* LAYOUT */
        .wrapper {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(180deg, #4361ee 0%, #3a0ca3 100%);
            color: white;
            position: fixed;
            left: 0;
            top: 0;
            height: 100%;
            z-index: 1000;
            transition: var(--transition);
            box-shadow: 5px 0 10px rgba(0, 0, 0, 0.05);
        }

        .sidebar.collapsed {
            transform: translateX(calc(-1 * var(--sidebar-width)));
        }

        .sidebar-header {
            height: var(--header-height);
            display: flex;
            align-items: center;
            padding: 0 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo {
            font-size: 1.4rem;
            font-weight: 700;
            display: flex;
            align-items: center;
        }

        .logo i {
            margin-right: 10px;
            font-size: 1.8rem;
        }

        .sidebar-content {
            height: calc(100% - var(--header-height));
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .menu {
            list-style: none;
            padding: 15px 0;
        }

        .menu-item {
            margin-bottom: 5px;
        }

        .menu-link {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: var(--transition);
            border-left: 3px solid transparent;
        }

        .menu-link:hover,
        .menu-link.active {
            background-color: rgba(255, 255, 255, 0.08);
            color: white;
            border-left-color: white;
        }

        .menu-link i {
            margin-right: 10px;
            font-size: 1.2rem;
            min-width: 25px;
            text-align: center;
        }

        .sidebar-footer {
            padding: 15px 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .user-info {
            display: flex;
            align-items: center;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: white;
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-right: 10px;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-details {
            flex-grow: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .user-role {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        .main-content {
            flex-grow: 1;
            margin-left: var(--sidebar-width);
            transition: var(--transition);
            padding: 20px;
            padding-top: calc(var(--header-height) + 20px);
        }

        .main-content.expanded {
            margin-left: 0;
        }

        .header {
            position: fixed;
            top: 0;
            right: 0;
            left: var(--sidebar-width);
            height: var(--header-height);
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 900;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
        }

        .header.expanded {
            left: 0;
        }

        .toggle-sidebar {
            background: none;
            border: none;
            color: var(--dark);
            font-size: 1.2rem;
            cursor: pointer;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }

        .toggle-sidebar:hover {
            background-color: var(--gray-light);
        }

        .header-title {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .header-actions {
            display: flex;
            align-items: center;
        }

        .sync-btn {
            padding: 8px 15px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            font-size: 0.85rem;
            transition: var(--transition);
            margin-right: 10px;
        }

        .sync-btn i {
            margin-right: 5px;
        }

        .sync-btn:hover {
            background-color: var(--primary-dark);
        }

        .logout-btn {
            border: none;
            background: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 1.1rem;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }

        .logout-btn:hover {
            background-color: var(--gray-light);
        }

        /* CONTENT */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--dark);
        }

        /* CARDS */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            transition: var(--transition);
        }

        .card:hover {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .stat-card {
            position: relative;
            overflow: hidden;
        }

        .stat-card.primary {
            border-left: 4px solid var(--primary);
        }

        .stat-card.success {
            border-left: 4px solid var(--success);
        }

        .stat-card.warning {
            border-left: 4px solid var(--warning);
        }

        .stat-card.danger {
            border-left: 4px solid var(--danger);
        }

        .stat-icon {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 3rem;
            opacity: 0.1;
            color: var(--dark);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--dark);
        }

        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .stat-trend {
            display: flex;
            align-items: center;
            font-size: 0.8rem;
        }

        .stat-trend.up {
            color: var(--success);
        }

        .stat-trend.down {
            color: var(--danger);
        }

        .stat-trend i {
            margin-right: 5px;
        }

        /* CHART CARDS */
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .chart-grid {
                grid-template-columns: 1fr;
            }
        }

        .chart-card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .chart-title {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--dark);
        }

        .chart-actions {
            display: flex;
            gap: 5px;
        }

        .chart-action {
            border: none;
            background: none;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            cursor: pointer;
            color: var(--gray);
            transition: var(--transition);
        }

        .chart-action:hover {
            background-color: var(--gray-light);
            color: var(--dark);
        }

        .chart-container {
            height: 250px;
            position: relative;
        }

        /* LOW STOCK ALERTS */
        .alerts-container {
            margin-bottom: 30px;
        }

        .alert-list {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }

        .alert-item {
            padding: 15px 20px;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            align-items: center;
        }

        .alert-item:last-child {
            border-bottom: none;
        }

        .alert-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .alert-icon.critical {
            background-color: rgba(255, 77, 109, 0.1);
            color: var(--danger);
        }

        .alert-icon.warning {
            background-color: rgba(247, 37, 133, 0.1);
            color: var(--warning);
        }

        .alert-info {
            flex-grow: 1;
        }

        .alert-title {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .alert-message {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .alert-action {
            flex-shrink: 0;
            padding: 5px 10px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .alert-action:hover {
            background-color: var(--primary-dark);
        }

        /* FORMS */
        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--dark);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            font-size: 0.85rem;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--gray-light);
            border-radius: 5px;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-success:hover {
            background-color: #3ab4db;
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background-color: #ff3357;
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        /* BATCH INPUT */
        .batch-input-container {
            margin-top: 20px;
        }

        .input-row {
            display: flex;
            margin-bottom: 10px;
            gap: 10px;
        }

        .input-row .form-control {
            flex-grow: 1;
        }

        .row-actions {
            display: flex;
            gap: 5px;
        }

        .btn-add-row,
        .btn-remove-row {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        /* TABLES */
        .table-container {
            margin-top: 30px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }

        .table-header {
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--gray-light);
        }

        .table-title {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .table-actions {
            display: flex;
            gap: 10px;
        }

        .table-filter {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .table-filter label {
            font-size: 0.85rem;
            font-weight: 500;
        }

        .table-filter select {
            padding: 5px 10px;
            border: 1px solid var(--gray-light);
            border-radius: 5px;
            font-size: 0.85rem;
        }

        .table-search {
            display: flex;
        }

        .table-search input {
            padding: 5px 10px;
            border: 1px solid var(--gray-light);
            border-radius: 5px 0 0 5px;
            font-size: 0.85rem;
        }

        .table-search button {
            padding: 5px 10px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 0 5px 5px 0;
            cursor: pointer;
        }

        .table-responsive {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--gray-light);
        }

        th {
            font-weight: 600;
            color: var(--dark);
            background-color: var(--gray-light);
        }

        tbody tr:hover {
            background-color: rgba(67, 97, 238, 0.05);
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        .action-cell {
            text-align: right;
            white-space: nowrap;
        }

        .btn-sm {
            padding: 5px 10px;
            font-size: 0.8rem;
        }

        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: 30px;
        }

        .status-badge.success {
            background-color: rgba(76, 201, 240, 0.1);
            color: var(--success);
        }

        .status-badge.warning {
            background-color: rgba(247, 37, 133, 0.1);
            color: var(--warning);
        }

        .status-badge.danger {
            background-color: rgba(255, 77, 109, 0.1);
            color: var(--danger);
        }

        /* TOAST NOTIFICATIONS */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
        }

        .toast {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 15px;
            margin-bottom: 10px;
            animation: slideInRight 0.3s ease forwards;
            display: flex;
            align-items: flex-start;
            overflow: hidden;
            position: relative;
        }

        .toast.removing {
            animation: slideOutRight 0.3s ease forwards;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }

            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        .toast-icon {
            margin-right: 15px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toast-success .toast-icon {
            color: var(--success);
        }

        .toast-error .toast-icon {
            color: var(--danger);
        }

        .toast-warning .toast-icon {
            color: var(--warning);
        }

        .toast-info .toast-icon {
            color: var(--primary);
        }

        .toast-content {
            flex-grow: 1;
            padding-right: 20px;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .toast-message {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .toast-close {
            position: absolute;
            top: 10px;
            right: 10px;
            border: none;
            background: none;
            font-size: 0.9rem;
            color: var(--gray);
            cursor: pointer;
            transition: var(--transition);
        }

        .toast-close:hover {
            color: var(--dark);
        }

        .toast-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            width: 100%;
            background-color: rgba(67, 97, 238, 0.2);
        }

        .toast-progress-bar {
            height: 100%;
            background-color: var(--primary);
            width: 100%;
            animation: progressBar 5s linear forwards;
        }

        @keyframes progressBar {
            from {
                width: 100%;
            }

            to {
                width: 0%;
            }
        }

        /* OVERLAY */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 990;
            display: none;
        }

        .overlay.active {
            display: block;
        }



        /* CORRECCIONES PARA RESPONSIVIDAD */

        /* Ajustes generales para dispositivos m√≥viles */
        @media (max-width: 576px) {

            /* Reducir padding general en m√≥viles */
            .card {
                padding: 15px 10px;
            }

            /* Ajustar espacio vertical en elementos del dashboard */
            .dashboard-cards {
                gap: 15px;
                margin-bottom: 20px;
            }

            /* Mejorar visualizaci√≥n de estad√≠sticas */
            .stat-value {
                font-size: 1.5rem;
            }

            /* Ajustar tama√±o de contenedor de gr√°ficos */
            .chart-container {
                height: 200px;
            }

            /* Centrar bien el contenido principal */
            .main-content {
                padding: 15px 10px;
                padding-top: calc(var(--header-height) + 15px);
            }

            /* Mejorar elementos de formulario */
            .form-group {
                margin-bottom: 15px;
            }

            /* Arreglar filas de entrada m√∫ltiple */
            .input-row {
                flex-direction: column;
                gap: 10px;
                margin-bottom: 20px;
            }

            .row-actions {
                width: 100%;
                justify-content: space-between;
                margin-top: 5px;
            }

            /* Ajustar botones de acci√≥n en filas */
            .btn-add-row,
            .btn-remove-row {
                width: 40px;
                height: 40px;
            }

            /* Mejorar legibilidad de tablas */
            th,
            td {
                padding: 10px;
                font-size: 0.85rem;
            }

            /* Hacer que las alertas usen todo el espacio disponible */
            .toast-container {
                width: calc(100% - 20px);
                max-width: none;
                padding: 0 10px;
            }

            /* Aumentar tama√±o m√≠nimo de elementos t√°ctiles */
            .btn,
            .form-control,
            select,
            .menu-link {
                min-height: 44px;
            }
        }

        /* Tablas responsivas mejoradas para m√≥viles */
        @media (max-width: 480px) {

            /* Transformar tablas a formato de tarjetas en m√≥vil */
            table,
            thead,
            tbody,
            th,
            td,
            tr {
                display: block;
            }

            thead tr {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }

            tr {
                border: 1px solid var(--gray-light);
                margin-bottom: 15px;
                border-radius: var(--border-radius);
                background-color: white;
                padding: 8px;
            }

            td {
                border: none;
                border-bottom: 1px solid var(--gray-light);
                position: relative;
                padding-left: 50%;
                text-align: right;
            }

            td:last-child {
                border-bottom: 0;
            }

            td:before {
                position: absolute;
                top: 12px;
                left: 12px;
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                content: attr(data-label);
                font-weight: 600;
                text-align: left;
            }

            .action-cell {
                text-align: center;
                padding: 10px;
            }

            /* Mejorar espaciado de botones en celdas de acci√≥n */
            .action-cell .btn {
                margin: 3px;
            }

            /* Ajustar altura de las filas de tabla */
            tbody tr {
                min-height: auto;
            }
        }

        /* Mejoras para los gr√°ficos */
        @media (max-width: 768px) {
            .chart-grid {
                grid-template-columns: 1fr;
            }

            /* Hacer gr√°ficos m√°s altos en vista m√≥vil */
            .chart-container {
                height: 250px;
                /* M√°s alto para mejor visualizaci√≥n */
            }

            .chart-card {
                margin-bottom: 20px;
            }
        }

        /* Ajustes para login en dispositivos peque√±os */
        @media (max-width: 400px) {
            .login-card {
                width: 90%;
                padding: 20px 15px;
            }

            .login-header h1 {
                font-size: 1.5rem;
            }
        }

        /* Ajuste para el sidebar en tablets */
        @media (max-width: 992px) and (min-width: 768px) {
            .sidebar.active {
                width: 280px;
            }

            .overlay.active {
                display: block;
            }
        }

        /* Ajustes de usabilidad generales */
        .btn,
        .form-control,
        select,
        button {
            touch-action: manipulation;
            /* Mejora interacciones t√°ctiles */
        }

        /* Mejora para que las secciones tengan un m√≠nimo de altura */
        .content-section.active {
            min-height: calc(100vh - var(--header-height) - 40px);
        }

        /* RESPONSIVE */
        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(calc(-1 * var(--sidebar-width)));
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .header {
                left: 0;
            }

            .toggle-sidebar {
                display: flex;
            }
        }

        @media (max-width: 768px) {
            .dashboard-cards {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .table-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .table-actions {
                width: 100%;
                flex-wrap: wrap;
            }

            .table-filter,
            .table-search {
                width: 100%;
            }
        }

        @media (max-width: 576px) {
            .header-title {
                display: none;
            }

            .card {
                padding: 15px;
            }

            .input-row {
                flex-direction: column;
                gap: 5px;
            }

            .row-actions {
                justify-content: flex-end;
            }
        }
    </style>
</head>

<body>
    <!-- Loader -->
    <div class="loader-container" id="loader">
        <div class="loader"></div>
    </div>

    <!-- Login Form -->
    <div class="login-container" id="loginContainer">
        <div class="login-card">
            <div class="login-header">
                <h1>Sistema de Bodega</h1>
                <p>Inicia sesi√≥n para acceder al sistema</p>
            </div>
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label for="loginNombre">Nombre completo</label>
                    <input type="text" id="loginNombre" required placeholder="Ingresa tu nombre">
                </div>
                <div class="form-group">
                    <label for="loginCargo">Cargo</label>
                    <select id="loginCargo" required>
                        <option value="">Selecciona tu cargo</option>
                        <option value="Inspector">Inspector</option>
                        <option value="Supervisor">Supervisor</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="loginTerminal">Terminal</label>
                    <select id="loginTerminal" required>
                        <option value="">Selecciona el terminal</option>
                        <option value="El Roble">El Roble</option>
                        <option value="La Reina">La Reina</option>
                        <option value="Maria Angelica">Maria Angelica</option>
                        <option value="El Descanso">El Descanso</option>
                    </select>
                </div>
                <button type="submit" class="login-btn">Iniciar Sesi√≥n</button>
            </form>

            <div class="login-divider">
                <span>O</span>
            </div>

            <button id="googleSignInBtn" class="google-btn">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNMTcuNiA5LjJsLS4xLTEuOEg5djMuNGg0LjhDMTMuNiAxMiAxMyAxMyAxMiAxMy42djIuMmgzYTguOCA4LjggMCAwIDAgMi42LTYuNnoiIGZpbGw9IiM0Mjg1RjQiIGZpbGwtcnVsZT0ibm9uemVybyIvPjxwYXRoIGQ9Ik05IDE4YzIuNCAwIDQuNS0uOCA2LTIuMmwtMy0yLjJhNS40IDUuNCAwIDAgMS04LTIuOUgxVjEzYTkgOSAwIDAgMCA4IDV6IiBmaWxsPSIjMzRBODUzIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNNCAxMC43YTUuNCA1LjQgMCAwIDEgMC0zLjRWNUgxYTkgOSAwIDAgMCAwIDhsMy0yLjN6IiBmaWxsPSIjRkJCQzA1IiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNOSAzLjZjMS4zIDAgMi41LjQgMy40IDEuM0wxNSAyLjNBOSA5IDAgMCAwIDEgNWwzIDIuNGE1LjQgNS40IDAgMCAxIDUtMy43eiIgZmlsbD0iI0VBNDMzNSIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHBhdGggZD0iTTAgMGgxOHYxOEgweiIvPjwvZz48L3N2Zz4="
                    alt="Google">
                <span>Iniciar con Google</span>
            </button>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Main Layout -->
    <div class="wrapper">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-warehouse"></i>
                    <span>Sistema Bodega</span>
                </div>
            </div>
            <div class="sidebar-content">
                <ul class="menu">
                    <li class="menu-item">
                        <a href="#" class="menu-link active" data-section="dashboard">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="menu-link" data-section="insumos">
                            <i class="fas fa-boxes"></i>
                            <span>Insumos</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="menu-link" data-section="entradas">
                            <i class="fas fa-truck-loading"></i>
                            <span>Entradas</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="menu-link" data-section="salidas">
                            <i class="fas fa-dolly-flatbed"></i>
                            <span>Salidas</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="menu-link" data-section="prestamos">
                            <i class="fas fa-exchange-alt"></i>
                            <span>Pr√©stamos</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="menu-link" data-section="personal">
                            <i class="fas fa-users"></i>
                            <span>Personal</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="menu-link" data-section="reportes">
                            <i class="fas fa-chart-bar"></i>
                            <span>Reportes</span>
                        </a>
                    </li>
                </ul>
                <div class="sidebar-footer">
                    <div class="user-info" id="userInfo">
                        <div class="user-avatar" id="userAvatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="user-details">
                            <div class="user-name" id="userName">Usuario</div>
                            <div class="user-role" id="userRole">Cargo - Terminal</div>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <!-- Header -->
            <header class="header" id="header">
                <div class="header-left">
                    <button id="toggleSidebar" class="toggle-sidebar">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 class="header-title">Sistema de Gesti√≥n de Bodega</h1>
                </div>
                <div class="header-actions">
                    <button id="syncButton" class="sync-btn">
                        <i class="fas fa-sync-alt"></i>
                        <span>Sincronizar</span>
                    </button>
                    <button id="logoutButton" class="logout-btn">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </header>

            <!-- Dashboard Section -->
            <section class="content-section active" id="dashboard-section">
                <h2 class="section-title">Dashboard</h2>

                <!-- Statistic Cards -->
                <div class="dashboard-cards">
                    <div class="card stat-card primary">
                        <i class="fas fa-boxes stat-icon"></i>
                        <div class="stat-value" id="totalInsumos">0</div>
                        <div class="stat-label">Total Insumos</div>
                        <div class="stat-trend up">
                            <i class="fas fa-arrow-up"></i>
                            <span>5% desde el mes pasado</span>
                        </div>
                    </div>

                    <div class="card stat-card success">
                        <i class="fas fa-dolly-flatbed stat-icon"></i>
                        <div class="stat-value" id="totalEntradas">0</div>
                        <div class="stat-label">Entradas este mes</div>
                        <div class="stat-trend up">
                            <i class="fas fa-arrow-up"></i>
                            <span>10% desde el mes pasado</span>
                        </div>
                    </div>

                    <div class="card stat-card warning">
                        <i class="fas fa-hand-holding stat-icon"></i>
                        <div class="stat-value" id="totalSalidas">0</div>
                        <div class="stat-label">Salidas este mes</div>
                        <div class="stat-trend down">
                            <i class="fas fa-arrow-down"></i>
                            <span>3% desde el mes pasado</span>
                        </div>
                    </div>

                    <div class="card stat-card danger">
                        <i class="fas fa-exclamation-triangle stat-icon"></i>
                        <div class="stat-value" id="bajoStock">0</div>
                        <div class="stat-label">Insumos en bajo stock</div>
                        <div class="stat-trend up">
                            <i class="fas fa-arrow-up"></i>
                            <span>2 m√°s que ayer</span>
                        </div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="chart-grid">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Movimientos del Mes</h3>
                            <div class="chart-actions">
                                <button class="chart-action">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button class="chart-action">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="movimientosChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Distribuci√≥n por Categor√≠a</h3>
                            <div class="chart-actions">
                                <button class="chart-action">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button class="chart-action">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="categoriasChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Low Stock Alerts -->
                <div class="alerts-container">
                    <h3 class="section-title">Alertas de Bajo Stock</h3>
                    <div class="alert-list" id="alertList">
                        <!-- Alerts will be loaded dynamically -->
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Actividad Reciente</h3>
                    </div>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Tipo</th>
                                    <th>Insumo</th>
                                    <th>Cantidad</th>
                                    <th>Responsable</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody id="actividadReciente">
                                <!-- Recent activity will be loaded dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Insumos Section -->
            <section class="content-section" id="insumos-section">
                <h2 class="section-title">Gesti√≥n de Insumos</h2>

                <!-- Add Insumo Form -->
                <div class="card">
                    <h3 class="card-title">Registrar Nuevo Insumo</h3>
                    <form id="insumoForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="insumoNombre" class="form-label">Nombre del Insumo</label>
                                <input type="text" id="insumoNombre" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="insumoCategoria" class="form-label">Categor√≠a</label>
                                <select id="insumoCategoria" class="form-control" required>
                                    <option value="">Seleccionar categor√≠a</option>
                                    <option value="Limpieza">Limpieza</option>
                                    <option value="Oficina">Oficina</option>
                                    <option value="Herramientas">Herramientas</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="insumoCantidad" class="form-label">Cantidad Inicial</label>
                                <input type="number" id="insumoCantidad" class="form-control" min="0" required>
                            </div>
                            <div class="form-group">
                                <label for="insumoUbicacion" class="form-label">Ubicaci√≥n</label>
                                <input type="text" id="insumoUbicacion" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="insumoDescripcion" class="form-label">Descripci√≥n</label>
                            <textarea id="insumoDescripcion" class="form-control" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Guardar Insumo</button>
                    </form>
                </div>

                <!-- Insumos Table -->
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Lista de Insumos</h3>
                        <div class="table-actions">
                            <div class="table-filter">
                                <label>Filtrar por:</label>
                                <select id="insumoFilter">
                                    <option value="todos">Todos</option>
                                    <option value="Limpieza">Limpieza</option>
                                    <option value="Oficina">Oficina</option>
                                    <option value="Herramientas">Herramientas</option>
                                </select>
                            </div>
                            <div class="table-search">
                                <input type="text" id="insumoSearch" placeholder="Buscar insumo...">
                                <button id="insumoSearchBtn"><i class="fas fa-search"></i></button>
                            </div>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Categor√≠a</th>
                                    <th>Stock Actual</th>
                                    <th>Ubicaci√≥n</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="insumosTable">
                                <!-- Insumos will be loaded dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Entradas Section -->
            <section class="content-section" id="entradas-section">
                <h2 class="section-title">Registro de Entradas</h2>

                <div class="card">
                    <h3 class="card-title">Registrar Entradas</h3>
                    <form id="entradaForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="entradaTipo" class="form-label">Tipo de Entrada</label>
                                <select id="entradaTipo" class="form-control" required>
                                    <option value="">Seleccionar tipo</option>
                                    <option value="Compra">Compra</option>
                                    <option value="Devoluci√≥n">Devoluci√≥n</option>
                                    <option value="Pr√©stamo">Pr√©stamo recibido</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="entradaFecha" class="form-label">Fecha</label>
                                <input type="date" id="entradaFecha" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="entradaResponsable" class="form-label">Responsable</label>
                                <select id="entradaResponsable" class="form-control" required>
                                    <option value="">Seleccionar responsable</option>
                                    <!-- Personal options will be loaded dynamically -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="entradaOrigen" class="form-label">Origen/Proveedor</label>
                                <input type="text" id="entradaOrigen" class="form-control">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Insumos</label>
                            <div class="batch-input-container" id="entradaItems">
                                <div class="input-row">
                                    <select class="form-control insumo-select" required>
                                        <option value="">Seleccionar insumo</option>
                                        <!-- Insumos options will be loaded dynamically -->
                                    </select>
                                    <input type="number" class="form-control" placeholder="Cantidad" min="1" required>
                                    <div class="row-actions">
                                        <button type="button" class="btn btn-primary btn-add-row"><i
                                                class="fas fa-plus"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="entradaNotas" class="form-label">Notas</label>
                            <textarea id="entradaNotas" class="form-control" rows="3"></textarea>
                        </div>

                        <button type="submit" class="btn btn-primary">Registrar Entrada</button>
                    </form>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Historial de Entradas</h3>
                        <div class="table-actions">
                            <div class="table-filter">
                                <label>Filtrar por:</label>
                                <select id="entradaFilter">
                                    <option value="todos">Todos</option>
                                    <option value="Compra">Compra</option>
                                    <option value="Devoluci√≥n">Devoluci√≥n</option>
                                    <option value="Pr√©stamo">Pr√©stamo recibido</option>
                                </select>
                            </div>
                            <div class="table-search">
                                <input type="text" id="entradaSearch" placeholder="Buscar...">
                                <button id="entradaSearchBtn"><i class="fas fa-search"></i></button>
                            </div>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Tipo</th>
                                    <th>Responsable</th>
                                    <th>Origen/Proveedor</th>
                                    <th>Insumos</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="entradasTable">
                                <!-- Entradas history will be loaded dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Salidas Section -->
            <section class="content-section" id="salidas-section">
                <h2 class="section-title">Registro de Salidas</h2>

                <div class="card">
                    <h3 class="card-title">Registrar Salidas</h3>
                    <form id="salidaForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="salidaTipo" class="form-label">Tipo de Salida</label>
                                <select id="salidaTipo" class="form-control" required>
                                    <option value="">Seleccionar tipo</option>
                                    <option value="Entrega">Entrega a personal</option>
                                    <option value="Pr√©stamo">Pr√©stamo a otro terminal</option>
                                    <option value="Baja">Baja de inventario</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="salidaFecha" class="form-label">Fecha</label>
                                <input type="date" id="salidaFecha" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="salidaResponsable" class="form-label">Responsable</label>
                                <select id="salidaResponsable" class="form-control" required>
                                    <option value="">Seleccionar responsable</option>
                                    <!-- Personal options will be loaded dynamically -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="salidaDestino" class="form-label">Destinatario</label>
                                <input type="text" id="salidaDestino" class="form-control">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Insumos</label>
                            <div class="batch-input-container" id="salidaItems">
                                <div class="input-row">
                                    <select class="form-control insumo-select" required>
                                        <option value="">Seleccionar insumo</option>
                                        <!-- Insumos options will be loaded dynamically -->
                                    </select>
                                    <input type="number" class="form-control" placeholder="Cantidad" min="1" required>
                                    <div class="row-actions">
                                        <button type="button" class="btn btn-primary btn-add-row"><i
                                                class="fas fa-plus"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="salidaNotas" class="form-label">Notas</label>
                            <textarea id="salidaNotas" class="form-control" rows="3"></textarea>
                        </div>

                        <button type="submit" class="btn btn-primary">Registrar Salida</button>
                    </form>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Historial de Salidas</h3>
                        <div class="table-actions">
                            <div class="table-filter">
                                <label>Filtrar por:</label>
                                <select id="salidaFilter">
                                    <option value="todos">Todos</option>
                                    <option value="Entrega">Entrega a personal</option>
                                    <option value="Pr√©stamo">Pr√©stamo a otro terminal</option>
                                    <option value="Baja">Baja de inventario</option>
                                </select>
                            </div>
                            <div class="table-search">
                                <input type="text" id="salidaSearch" placeholder="Buscar...">
                                <button id="salidaSearchBtn"><i class="fas fa-search"></i></button>
                            </div>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Tipo</th>
                                    <th>Responsable</th>
                                    <th>Destinatario</th>
                                    <th>Insumos</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="salidasTable">
                                <!-- Salidas history will be loaded dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Prestamos Section -->
            <section class="content-section" id="prestamos-section">
                <h2 class="section-title">Gesti√≥n de Pr√©stamos</h2>

                <div class="card">
                    <h3 class="card-title">Registrar Pr√©stamo</h3>
                    <form id="prestamoForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="prestamoTipo" class="form-label">Tipo de Pr√©stamo</label>
                                <select id="prestamoTipo" class="form-control" required>
                                    <option value="">Seleccionar tipo</option>
                                    <option value="Otorgado">Pr√©stamo otorgado</option>
                                    <option value="Recibido">Pr√©stamo recibido</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="prestamoFecha" class="form-label">Fecha</label>
                                <input type="date" id="prestamoFecha" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="prestamoTerminal" class="form-label">Terminal</label>
                                <select id="prestamoTerminal" class="form-control" required>
                                    <option value="">Seleccionar terminal</option>
                                    <option value="El Roble">El Roble</option>
                                    <option value="La Reina">La Reina</option>
                                    <option value="Maria Angelica">Maria Angelica</option>
                                    <option value="El Descanso">El Descanso</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="prestamoContacto" class="form-label">Contacto</label>
                                <input type="text" id="prestamoContacto" class="form-control" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Insumos</label>
                            <div class="batch-input-container" id="prestamoItems">
                                <div class="input-row">
                                    <select class="form-control insumo-select" required>
                                        <option value="">Seleccionar insumo</option>
                                        <!-- Insumos options will be loaded dynamically -->
                                    </select>
                                    <input type="number" class="form-control" placeholder="Cantidad" min="1" required>
                                    <div class="row-actions">
                                        <button type="button" class="btn btn-primary btn-add-row"><i
                                                class="fas fa-plus"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="prestamoFechaDevolucion" class="form-label">Fecha de Devoluci√≥n Prevista</label>
                            <input type="date" id="prestamoFechaDevolucion" class="form-control">
                        </div>

                        <div class="form-group">
                            <label for="prestamoNotas" class="form-label">Notas</label>
                            <textarea id="prestamoNotas" class="form-control" rows="3"></textarea>
                        </div>

                        <button type="submit" class="btn btn-primary">Registrar Pr√©stamo</button>
                    </form>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Pr√©stamos Activos</h3>
                        <div class="table-actions">
                            <div class="table-filter">
                                <label>Filtrar por:</label>
                                <select id="prestamoFilter">
                                    <option value="todos">Todos</option>
                                    <option value="Otorgado">Otorgados</option>
                                    <option value="Recibido">Recibidos</option>
                                </select>
                            </div>
                            <div class="table-search">
                                <input type="text" id="prestamoSearch" placeholder="Buscar...">
                                <button id="prestamoSearchBtn"><i class="fas fa-search"></i></button>
                            </div>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Tipo</th>
                                    <th>Terminal</th>
                                    <th>Contacto</th>
                                    <th>Insumos</th>
                                    <th>Fecha Devoluci√≥n</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="prestamosTable">
                                <!-- Pr√©stamos will be loaded dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Personal Section -->
            <section class="content-section" id="personal-section">
                <h2 class="section-title">Gesti√≥n de Personal</h2>

                <div class="card">
                    <h3 class="card-title">Registrar Personal</h3>
                    <form id="personalForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="personalNombre" class="form-label">Nombre completo</label>
                                <input type="text" id="personalNombre" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="personalCargo" class="form-label">Cargo</label>
                                <select id="personalCargo" class="form-control" required>
                                    <option value="">Seleccionar cargo</option>
                                    <option value="Inspector">Inspector</option>
                                    <option value="Supervisor">Supervisor</option>
                                    <option value="Operario">Operario</option>
                                    <option value="Auxiliar">Auxiliar</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="personalTerminal" class="form-label">Terminal</label>
                                <select id="personalTerminal" class="form-control" required>
                                    <option value="">Seleccionar terminal</option>
                                    <option value="El Roble">El Roble</option>
                                    <option value="La Reina">La Reina</option>
                                    <option value="Maria Angelica">Maria Angelica</option>
                                    <option value="El Descanso">El Descanso</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="personalCorreo" class="form-label">Correo electr√≥nico</label>
                                <input type="email" id="personalCorreo" class="form-control">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="personalNotas" class="form-label">Notas</label>
                            <textarea id="personalNotas" class="form-control" rows="3"></textarea>
                        </div>

                        <button type="submit" class="btn btn-primary">Guardar Personal</button>
                    </form>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Lista de Personal</h3>
                        <div class="table-actions">
                            <div class="table-filter">
                                <label>Filtrar por:</label>
                                <select id="personalFilter">
                                    <option value="todos">Todos</option>
                                    <option value="Inspector">Inspector</option>
                                    <option value="Supervisor">Supervisor</option>
                                    <option value="Operario">Operario</option>
                                    <option value="Auxiliar">Auxiliar</option>
                                </select>
                            </div>
                            <div class="table-search">
                                <input type="text" id="personalSearch" placeholder="Buscar...">
                                <button id="personalSearchBtn"><i class="fas fa-search"></i></button>
                            </div>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Cargo</th>
                                    <th>Terminal</th>
                                    <th>Correo electr√≥nico</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="personalTable">
                                <!-- Personal will be loaded dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Reportes Section -->
            <section class="content-section" id="reportes-section">
                <h2 class="section-title">Reportes</h2>

                <div class="card">
                    <h3 class="card-title">Generar Reporte</h3>
                    <form id="reporteForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="reporteTipo" class="form-label">Tipo de Reporte</label>
                                <select id="reporteTipo" class="form-control" required>
                                    <option value="">Seleccionar tipo</option>
                                    <option value="insumos">Inventario de Insumos</option>
                                    <option value="movimientos">Movimientos</option>
                                    <option value="prestamos">Pr√©stamos</option>
                                    <option value="bajoStock">Insumos en Bajo Stock</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="reporteFechaInicio" class="form-label">Fecha Inicio</label>
                                <input type="date" id="reporteFechaInicio" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="reporteFechaFin" class="form-label">Fecha Fin</label>
                                <input type="date" id="reporteFechaFin" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="reporteCategoria" class="form-label">Categor√≠a</label>
                                <select id="reporteCategoria" class="form-control">
                                    <option value="">Todas las categor√≠as</option>
                                    <option value="Limpieza">Limpieza</option>
                                    <option value="Oficina">Oficina</option>
                                    <option value="Herramientas">Herramientas</option>
                                </select>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary">Generar Reporte</button>
                    </form>
                </div>

                <div class="chart-grid">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Evoluci√≥n de Inventario</h3>
                            <div class="chart-actions">
                                <button class="chart-action">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button class="chart-action">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="evolucionInventarioChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Distribuci√≥n de Salidas</h3>
                            <div class="chart-actions">
                                <button class="chart-action">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button class="chart-action">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="distribucionSalidasChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Resultado del Reporte</h3>
                        <div class="table-actions">
                            <button class="btn btn-success btn-sm" id="exportExcelBtn">
                                <i class="fas fa-file-excel"></i> Exportar a Excel
                            </button>
                            <button class="btn btn-primary btn-sm" id="exportPdfBtn">
                                <i class="fas fa-file-pdf"></i> Exportar a PDF
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table id="reporteTable">
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Categor√≠a</th>
                                    <th>Stock Inicial</th>
                                    <th>Entradas</th>
                                    <th>Salidas</th>
                                    <th>Stock Actual</th>
                                </tr>
                            </thead>
                            <tbody id="reporteResultados">
                                <!-- Report results will be loaded dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Overlay for mobile -->
    <div class="overlay" id="overlay"></div>

    <!-- Scripts -->
    <script>

        // Constantes para la API de Google Sheets
        const API_KEY = 'AIzaSyDwUO5PpwoNbVbWfKViTEQO8Lnpkl12D5c';
        const CLIENT_ID = '749139679919-3bc57iab4hj1qv7uh6r7s9tn6lp8r389.apps.googleusercontent.com';
        const SPREADSHEET_ID = '1gdOiPNqcfb6Mc5Y60fz_6KGnpM2MqB8JWesJsxrIGbI';

        // Scope para la autorizaci√≥n de Google
        const SCOPES = 'https://www.googleapis.com/auth/spreadsheets';

        // Variables globales
        let tokenClient;
        let gapiInited = false;
        let gisInited = false;
        let isAuthenticated = false;
        let currentUser = null;
        let insumos = [];
        let personal = [];
        let entradas = [];
        let salidas = [];
        let prestamos = [];

        // DOM Elements
        const loader = document.getElementById('loader');
        const loginContainer = document.getElementById('loginContainer');
        const sidebar = document.getElementById('sidebar');
        const header = document.getElementById('header');
        const mainContent = document.getElementById('mainContent');
        const toggleSidebar = document.getElementById('toggleSidebar');
        const overlay = document.getElementById('overlay');
        const loginForm = document.getElementById('loginForm');
        const googleSignInBtn = document.getElementById('googleSignInBtn');
        const syncButton = document.getElementById('syncButton');
        const logoutButton = document.getElementById('logoutButton');
        const menuLinks = document.querySelectorAll('.menu-link');
        const contentSections = document.querySelectorAll('.content-section');
        const toastContainer = document.getElementById('toastContainer');
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const userRole = document.getElementById('userRole');

        // Charts
        let movimientosChart;
        let categoriasChart;
        let evolucionInventarioChart;
        let distribucionSalidasChart;

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', initApp);

        /**
         * Inicializa la aplicaci√≥n
         */
        function initApp() {
            // Configurar event listeners
            setupEventListeners();

            // Cargar la API de Google
            loadGoogleApi();
        }

        /**
         * Configura los event listeners de la aplicaci√≥n
         */
        function setupEventListeners() {
            // Toggle sidebar
            if (toggleSidebar) {
                toggleSidebar.addEventListener('click', () => {
                    sidebar.classList.toggle('active');
                    overlay.classList.toggle('active');
                    header.classList.toggle('expanded');
                    mainContent.classList.toggle('expanded');
                });
            }

            // Cerrar sidebar al hacer clic en overlay
            if (overlay) {
                overlay.addEventListener('click', () => {
                    sidebar.classList.remove('active');
                    overlay.classList.remove('active');
                });
            }

            // Navegaci√≥n del men√∫
            menuLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();

                    // Remover clase active de todos los links
                    menuLinks.forEach(l => l.classList.remove('active'));

                    // Agregar clase active al link actual
                    link.classList.add('active');

                    // Mostrar la secci√≥n correspondiente
                    const sectionId = link.getAttribute('data-section');
                    showSection(sectionId);

                    // En m√≥viles, cerrar el sidebar despu√©s de hacer clic
                    if (window.innerWidth < 992) {
                        sidebar.classList.remove('active');
                        overlay.classList.remove('active');
                    }
                });
            });

            // Login form
            if (loginForm) {
                loginForm.addEventListener('submit', handleLogin);
            }

            // Logout button
            if (logoutButton) {
                logoutButton.addEventListener('click', handleLogout);
            }

            // Sync button
            if (syncButton) {
                syncButton.addEventListener('click', syncData);
            }

            // Forms
            setupForms();
        }

        /**
         * Muestra una secci√≥n espec√≠fica de contenido
         * @param {string} sectionId - ID de la secci√≥n a mostrar
         */
        function showSection(sectionId) {
            contentSections.forEach(section => {
                section.classList.remove('active');
            });

            const targetSection = document.getElementById(`${sectionId}-section`);
            if (targetSection) {
                targetSection.classList.add('active');
            }
        }

        /**
         * Configura los formularios de la aplicaci√≥n
         */
        function setupForms() {
            // Insumo form
            const insumoForm = document.getElementById('insumoForm');
            if (insumoForm) {
                insumoForm.addEventListener('submit', handleInsumoSubmit);
            }

            // Entrada form
            const entradaForm = document.getElementById('entradaForm');
            if (entradaForm) {
                entradaForm.addEventListener('submit', handleEntradaSubmit);

                // Add row button in entrada form
                const entradaItems = document.getElementById('entradaItems');
                if (entradaItems) {
                    entradaItems.addEventListener('click', (e) => {
                        if (e.target.classList.contains('btn-add-row') || e.target.parentElement.classList.contains('btn-add-row')) {
                            addEntradaRow(entradaItems);
                        } else if (e.target.classList.contains('btn-remove-row') || e.target.parentElement.classList.contains('btn-remove-row')) {
                            const row = e.target.closest('.input-row');
                            if (entradaItems.querySelectorAll('.input-row').length > 1) {
                                row.remove();
                            }
                        }
                    });
                }
            }

            // Salida form
            const salidaForm = document.getElementById('salidaForm');
            if (salidaForm) {
                salidaForm.addEventListener('submit', handleSalidaSubmit);

                // Add row button in salida form
                const salidaItems = document.getElementById('salidaItems');
                if (salidaItems) {
                    salidaItems.addEventListener('click', (e) => {
                        if (e.target.classList.contains('btn-add-row') || e.target.parentElement.classList.contains('btn-add-row')) {
                            addSalidaRow(salidaItems);
                        } else if (e.target.classList.contains('btn-remove-row') || e.target.parentElement.classList.contains('btn-remove-row')) {
                            const row = e.target.closest('.input-row');
                            if (salidaItems.querySelectorAll('.input-row').length > 1) {
                                row.remove();
                            }
                        }
                    });
                }
            }

            // Prestamo form
            const prestamoForm = document.getElementById('prestamoForm');
            if (prestamoForm) {
                prestamoForm.addEventListener('submit', handlePrestamoSubmit);

                // Add row button in prestamo form
                const prestamoItems = document.getElementById('prestamoItems');
                if (prestamoItems) {
                    prestamoItems.addEventListener('click', (e) => {
                        if (e.target.classList.contains('btn-add-row') || e.target.parentElement.classList.contains('btn-add-row')) {
                            addPrestamoRow(prestamoItems);
                        } else if (e.target.classList.contains('btn-remove-row') || e.target.parentElement.classList.contains('btn-remove-row')) {
                            const row = e.target.closest('.input-row');
                            if (prestamoItems.querySelectorAll('.input-row').length > 1) {
                                row.remove();
                            }
                        }
                    });
                }
            }

            // Personal form
            const personalForm = document.getElementById('personalForm');
            if (personalForm) {
                personalForm.addEventListener('submit', handlePersonalSubmit);
            }

            // Reporte form
            const reporteForm = document.getElementById('reporteForm');
            if (reporteForm) {
                reporteForm.addEventListener('submit', handleReporteSubmit);
            }

            // Filtros de tabla
            setupTableFilters();
        }

        /**
         * Configura los filtros de las tablas
         */
        function setupTableFilters() {
            // Insumos filter
            const insumoFilter = document.getElementById('insumoFilter');
            const insumoSearch = document.getElementById('insumoSearch');
            const insumoSearchBtn = document.getElementById('insumoSearchBtn');

            if (insumoFilter) {
                insumoFilter.addEventListener('change', () => {
                    filterInsumos();
                });
            }

            if (insumoSearchBtn) {
                insumoSearchBtn.addEventListener('click', () => {
                    filterInsumos();
                });
            }

            if (insumoSearch) {
                insumoSearch.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        filterInsumos();
                    }
                });
            }

            // Entrada filter
            const entradaFilter = document.getElementById('entradaFilter');
            const entradaSearch = document.getElementById('entradaSearch');
            const entradaSearchBtn = document.getElementById('entradaSearchBtn');

            if (entradaFilter) {
                entradaFilter.addEventListener('change', () => {
                    filterEntradas();
                });
            }

            if (entradaSearchBtn) {
                entradaSearchBtn.addEventListener('click', () => {
                    filterEntradas();
                });
            }

            if (entradaSearch) {
                entradaSearch.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        filterEntradas();
                    }
                });
            }

            // Salida filter
            const salidaFilter = document.getElementById('salidaFilter');
            const salidaSearch = document.getElementById('salidaSearch');
            const salidaSearchBtn = document.getElementById('salidaSearchBtn');

            if (salidaFilter) {
                salidaFilter.addEventListener('change', () => {
                    filterSalidas();
                });
            }

            if (salidaSearchBtn) {
                salidaSearchBtn.addEventListener('click', () => {
                    filterSalidas();
                });
            }

            if (salidaSearch) {
                salidaSearch.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        filterSalidas();
                    }
                });
            }

            // Prestamo filter
            const prestamoFilter = document.getElementById('prestamoFilter');
            const prestamoSearch = document.getElementById('prestamoSearch');
            const prestamoSearchBtn = document.getElementById('prestamoSearchBtn');

            if (prestamoFilter) {
                prestamoFilter.addEventListener('change', () => {
                    filterPrestamos();
                });
            }

            if (prestamoSearchBtn) {
                prestamoSearchBtn.addEventListener('click', () => {
                    filterPrestamos();
                });
            }

            if (prestamoSearch) {
                prestamoSearch.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        filterPrestamos();
                    }
                });
            }

            // Personal filter
            const personalFilter = document.getElementById('personalFilter');
            const personalSearch = document.getElementById('personalSearch');
            const personalSearchBtn = document.getElementById('personalSearchBtn');

            if (personalFilter) {
                personalFilter.addEventListener('change', () => {
                    filterPersonal();
                });
            }

            if (personalSearchBtn) {
                personalSearchBtn.addEventListener('click', () => {
                    filterPersonal();
                });
            }

            if (personalSearch) {
                personalSearch.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        filterPersonal();
                    }
                });
            }
        }

        /**
         * Carga la API de Google
         */
        function loadGoogleApi() {
            // Cargar el script de gapi
            const gapiScript = document.createElement('script');
            gapiScript.src = 'https://apis.google.com/js/api.js';
            gapiScript.onload = initGapi;
            document.body.appendChild(gapiScript);

            // Cargar el script de gis
            const gisScript = document.createElement('script');
            gisScript.src = 'https://accounts.google.com/gsi/client';
            gisScript.onload = initGis;
            document.body.appendChild(gisScript);
        }

        /**
         * Inicializa la API de Google
         */
        async function initGapi() {
            try {
                await new Promise((resolve, reject) => {
                    gapi.load('client', { callback: resolve, onerror: reject });
                });

                await gapi.client.init({
                    apiKey: API_KEY,
                    discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
                });

                gapiInited = true;
                maybeStartApp();
            } catch (error) {
                console.error('Error initializing GAPI', error);
                showToast('Error al inicializar Google API', 'error');
            }
        }

        /**
         * Inicializa GIS para autenticaci√≥n
         */
        function initGis() {
            try {
                tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: CLIENT_ID,
                    scope: SCOPES,
                    callback: handleAuthResponse,
                });

                gisInited = true;
                maybeStartApp();
            } catch (error) {
                console.error('Error initializing GIS', error);
                showToast('Error al inicializar Google Sign-In', 'error');
            }
        }

        /**
         * Verifica si se pueden iniciar las APIs y habilita el formulario de inicio de sesi√≥n
         */
        function maybeStartApp() {
            if (gapiInited && gisInited) {
                // Habilitar el bot√≥n de inicio de sesi√≥n con Google
                const googleSignInBtn = document.getElementById('googleSignInBtn');
                if (googleSignInBtn) {
                    googleSignInBtn.addEventListener('click', handleAuthClick);
                }

                // Ocultar el loader
                loader.style.display = 'none';
            }
        }

        /**
         * Maneja el clic en el bot√≥n de autenticaci√≥n de Google
         */
        function handleAuthClick() {
            tokenClient.requestAccessToken({ prompt: 'consent' });
        }

        /**
         * Maneja la respuesta de la autenticaci√≥n de Google
         * @param {Object} response - Respuesta de autenticaci√≥n
         */
        async function handleAuthResponse(response) {
            if (response.error !== undefined) {
                showToast('Error de autenticaci√≥n: ' + response.error, 'error');
                return;
            }

            isAuthenticated = true;

            // Usar informaci√≥n local en lugar de intentar obtener perfil de Google
            if (currentUser) {
                // Ya tenemos la informaci√≥n del login manual
                updateUserInterface();
                loadAllData();
            } else {
                // Crear un usuario gen√©rico si no hay login manual
                currentUser = {
                    nombre: "Usuario Autenticado",
                    cargo: "Operador",
                    terminal: "Terminal Principal",
                    correo: ""
                };
                updateUserInterface();
                loadAllData();
            }

            showToast(`Sesi√≥n iniciada correctamente`, 'success');
        }

        async function createRequiredSheets() {
            try {
                showLoader();

                // Obtener informaci√≥n sobre el spreadsheet
                const response = await gapi.client.sheets.spreadsheets.get({
                    spreadsheetId: SPREADSHEET_ID
                });

                const existingSheets = response.result.sheets.map(sheet => sheet.properties.title);
                const requiredSheets = ['insumos', 'personal', 'entradas', 'salidas', 'prestamos'];
                const sheetsToCreate = [];

                // Verificar qu√© hojas necesitan ser creadas
                for (const sheet of requiredSheets) {
                    if (!existingSheets.includes(sheet)) {
                        sheetsToCreate.push(sheet);
                    }
                }

                // Crear las hojas que faltan
                if (sheetsToCreate.length > 0) {
                    const requests = sheetsToCreate.map(title => ({
                        addSheet: {
                            properties: { title }
                        }
                    }));

                    await gapi.client.sheets.spreadsheets.batchUpdate({
                        spreadsheetId: SPREADSHEET_ID,
                        resource: { requests }
                    });

                    showToast(`Se crearon las hojas necesarias: ${sheetsToCreate.join(', ')}`, 'success');
                }

                // Inicializar encabezados si es necesario
                await initializeSheetHeaders();

                hideLoader();
                return true;
            } catch (error) {
                console.error('Error al crear hojas:', error);
                hideLoader();
                showToast('Error al crear las hojas necesarias. Verifica los permisos.', 'error');
                return false;
            }
        }


        async function initializeSheetHeaders() {
            try {
                // Definir encabezados para cada hoja
                const headers = {
                    'insumos': ['Nombre', 'Categor√≠a', 'Cantidad', 'Ubicaci√≥n', 'Descripci√≥n', 'Fecha Registro'],
                    'personal': ['Nombre', 'Cargo', 'Terminal', 'Correo', 'Notas'],
                    'entradas': ['Fecha', 'Tipo', 'Responsable', 'Origen', 'Items'],
                    'salidas': ['Fecha', 'Tipo', 'Responsable', 'Destino', 'Items'],
                    'prestamos': ['Fecha', 'Tipo', 'Terminal', 'Contacto', 'Items', 'Fecha Devoluci√≥n', 'Estado']
                };

                // Establecer encabezados en cada hoja
                for (const [sheet, header] of Object.entries(headers)) {
                    await gapi.client.sheets.spreadsheets.values.update({
                        spreadsheetId: SPREADSHEET_ID,
                        range: `${sheet}!A1:${String.fromCharCode(65 + header.length - 1)}1`,
                        valueInputOption: 'RAW',
                        resource: {
                            values: [header]
                        }
                    });
                }

                return true;
            } catch (error) {
                console.error('Error al inicializar encabezados:', error);
                showToast('Error al inicializar encabezados de las hojas', 'error');
                return false;
            }
        }
        /**
         * Obtiene el perfil del usuario de Google
         */
        async function getGoogleUserProfile() {
            try {
                const response = await gapi.client.request({
                    path: 'https://www.googleapis.com/oauth2/v3/userinfo'
                });

                const userProfile = response.result;

                currentUser = {
                    nombre: userProfile.name,
                    correo: userProfile.email,
                    foto: userProfile.picture,
                    cargo: 'Supervisor',
                    terminal: 'El Roble'
                };

                updateUserInterface();
                showToast(`Bienvenido ${currentUser.nombre}`, 'success');

                // Cargar datos desde Google Sheets
                loadAllData();

            } catch (error) {
                console.error('Error getting user profile', error);
                showToast('Error al obtener perfil de usuario', 'error');
            }
        }

        /**
         * Maneja el inicio de sesi√≥n manual
         * @param {Event} e - Evento del formulario
         */
        function handleLogin(e) {
            e.preventDefault();

            const nombre = document.getElementById('loginNombre').value;
            const cargo = document.getElementById('loginCargo').value;
            const terminal = document.getElementById('loginTerminal').value;

            if (!nombre || !cargo || !terminal) {
                showToast('Por favor, completa todos los campos', 'warning');
                return;
            }

            currentUser = {
                nombre: nombre,
                cargo: cargo,
                terminal: terminal,
                correo: ''
            };

            updateUserInterface();
            showToast(`Bienvenido ${currentUser.nombre}`, 'success');

            // Iniciar la aplicaci√≥n si estamos autenticados con Google, o solicitar autenticaci√≥n
            if (isAuthenticated) {
                loadAllData();
            } else {
                handleAuthClick();
            }
        }

        /**
         * Actualiza la interfaz de usuario despu√©s del inicio de sesi√≥n
         */
        function updateUserInterface() {
            // Ocultar login container
            loginContainer.style.display = 'none';

            // Actualizar info del usuario
            if (userName) userName.textContent = currentUser.nombre;
            if (userRole) userRole.textContent = `${currentUser.cargo} - ${currentUser.terminal}`;

            if (userAvatar) {
                if (currentUser.foto) {
                    userAvatar.innerHTML = `<img src="${currentUser.foto}" alt="${currentUser.nombre}">`;
                } else {
                    userAvatar.innerHTML = `<i class="fas fa-user"></i>`;
                }
            }
        }

        /**
         * Maneja el cierre de sesi√≥n
         */
        function handleLogout() {
            if (isAuthenticated) {
                const token = gapi.client.getToken();
                if (token !== null) {
                    google.accounts.oauth2.revoke(token.access_token);
                    gapi.client.setToken('');
                }
            }

            isAuthenticated = false;
            currentUser = null;

            // Mostrar login container
            loginContainer.style.display = 'flex';

            // Limpiar datos
            insumos = [];
            personal = [];
            entradas = [];
            salidas = [];
            prestamos = [];

            // Limpiar formularios
            resetForms();

            showToast('Sesi√≥n cerrada correctamente', 'info');
        }

        /**
         * Reinicia todos los formularios
         */
        function resetForms() {
            const forms = document.querySelectorAll('form');
            forms.forEach(form => form.reset());
        }

        /**
         * Carga todos los datos desde Google Sheets
         */
        async function loadAllData() {
            showLoader();

            try {
                // Primero crear las hojas necesarias
                const sheetsCreated = await createRequiredSheets();
                if (!sheetsCreated) {
                    hideLoader();
                    return;
                }

                await Promise.all([
                    loadPersonal(),
                    loadInsumos(),
                    loadEntradas(),
                    loadSalidas(),
                    loadPrestamos()
                ]);

                // Actualizar interface
                updateDashboard();
                populateSelects();

                hideLoader();
                showToast('Datos cargados correctamente', 'success');

            } catch (error) {
                console.error('Error cargando datos', error);
                hideLoader();
                showToast('Error al cargar datos', 'error');
            }
        }

        /**
         * Carga los datos de personal desde Google Sheets
         */
        async function loadPersonal() {
            try {
                const response = await gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'personal!A2:E'
                });

                personal = [];

                if (response.result.values && response.result.values.length > 0) {
                    response.result.values.forEach((row) => {
                        personal.push({
                            nombre: row[0] || '',
                            cargo: row[1] || '',
                            terminal: row[2] || '',
                            correo: row[3] || '',
                            notas: row[4] || ''
                        });
                    });
                }

                renderPersonalTable();
                return personal;

            } catch (error) {
                console.error('Error al cargar personal', error);
                showToast('Error al cargar personal', 'error');
                return [];
            }
        }

        /**
         * Carga los datos de insumos desde Google Sheets
         */
        async function loadInsumos() {
            try {
                const response = await gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'insumos!A2:F'
                });

                insumos = [];

                if (response.result.values && response.result.values.length > 0) {
                    response.result.values.forEach((row) => {
                        insumos.push({
                            nombre: row[0] || '',
                            categoria: row[1] || '',
                            cantidad: parseInt(row[2]) || 0,
                            ubicacion: row[3] || '',
                            descripcion: row[4] || '',
                            fechaRegistro: row[5] || new Date().toISOString()
                        });
                    });
                }

                renderInsumosTable();
                return insumos;

            } catch (error) {
                console.error('Error al cargar insumos', error);
                showToast('Error al cargar insumos', 'error');
                return [];
            }
        }

        /**
         * Carga los datos de entradas desde Google Sheets
         */
        async function loadEntradas() {
            try {
                const response = await gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'entradas!A2:E'
                });

                entradas = [];

                if (response.result.values && response.result.values.length > 0) {
                    response.result.values.forEach((row) => {
                        entradas.push({
                            fecha: row[0] || '',
                            tipo: row[1] || '',
                            responsable: row[2] || '',
                            origen: row[3] || '',
                            items: JSON.parse(row[4] || '[]')
                        });
                    });
                }

                renderEntradasTable();
                return entradas;

            } catch (error) {
                console.error('Error al cargar entradas', error);
                showToast('Error al cargar entradas', 'error');
                return [];
            }
        }

        /**
         * Carga los datos de salidas desde Google Sheets
         */
        async function loadSalidas() {
            try {
                const response = await gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'salidas!A2:E'
                });

                salidas = [];

                if (response.result.values && response.result.values.length > 0) {
                    response.result.values.forEach((row) => {
                        salidas.push({
                            fecha: row[0] || '',
                            tipo: row[1] || '',
                            responsable: row[2] || '',
                            destino: row[3] || '',
                            items: JSON.parse(row[4] || '[]')
                        });
                    });
                }

                renderSalidasTable();
                return salidas;

            } catch (error) {
                console.error('Error al cargar salidas', error);
                showToast('Error al cargar salidas', 'error');
                return [];
            }
        }

        /**
         * Carga los datos de pr√©stamos desde Google Sheets
         */
        async function loadPrestamos() {
            try {
                const response = await gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'prestamos!A2:G'
                });

                prestamos = [];

                if (response.result.values && response.result.values.length > 0) {
                    response.result.values.forEach((row) => {
                        prestamos.push({
                            fecha: row[0] || '',
                            tipo: row[1] || '',
                            terminal: row[2] || '',
                            contacto: row[3] || '',
                            items: JSON.parse(row[4] || '[]'),
                            fechaDevolucion: row[5] || '',
                            estado: row[6] || 'Activo'
                        });
                    });
                }

                renderPrestamosTable();
                return prestamos;

            } catch (error) {
                console.error('Error al cargar pr√©stamos', error);
                showToast('Error al cargar pr√©stamos', 'error');
                return [];
            }
        }

        /**
         * Actualiza el dashboard con los datos cargados
         */
        function updateDashboard() {
            // Actualizar contadores
            const totalInsumosElement = document.getElementById('totalInsumos');
            const totalEntradasElement = document.getElementById('totalEntradas');
            const totalSalidasElement = document.getElementById('totalSalidas');
            const bajoStockElement = document.getElementById('bajoStock');

            if (totalInsumosElement) totalInsumosElement.textContent = insumos.length;

            // Contar entradas del mes actual
            const entradasMes = entradas.filter(entrada => {
                const fechaEntrada = new Date(entrada.fecha);
                const hoy = new Date();
                return fechaEntrada.getMonth() === hoy.getMonth() &&
                    fechaEntrada.getFullYear() === hoy.getFullYear();
            });

            if (totalEntradasElement) totalEntradasElement.textContent = entradasMes.length;

            // Contar salidas del mes actual
            const salidasMes = salidas.filter(salida => {
                const fechaSalida = new Date(salida.fecha);
                const hoy = new Date();
                return fechaSalida.getMonth() === hoy.getMonth() &&
                    fechaSalida.getFullYear() === hoy.getFullYear();
            });

            if (totalSalidasElement) totalSalidasElement.textContent = salidasMes.length;

            // Calcular insumos en bajo stock
            const bajoStock = insumos.filter(insumo => {
                if (insumo.categoria === 'Limpieza' && insumo.cantidad < 10) return true;
                if (insumo.categoria === 'Oficina' && insumo.cantidad < 5) return true;
                return false;
            });

            if (bajoStockElement) bajoStockElement.textContent = bajoStock.length;

            // Actualizar alertas de bajo stock
            renderBajoStockAlerts(bajoStock);

            // Actualizar tabla de actividad reciente
            renderActividadReciente();

            // Inicializar gr√°ficos
            initCharts();
        }

        /**
         * Renderiza las alertas de bajo stock
         * @param {Array} bajoStock - Array de insumos en bajo stock
         */
        function renderBajoStockAlerts(bajoStock) {
            const alertList = document.getElementById('alertList');
            if (!alertList) return;

            alertList.innerHTML = '';

            if (bajoStock.length === 0) {
                alertList.innerHTML = `
            <div class="alert-item">
                <div class="alert-icon success">
                    <i class="fas fa-check"></i>
                </div>
                <div class="alert-info">
                    <div class="alert-title">Todo en orden</div>
                    <div class="alert-message">No hay insumos en nivel cr√≠tico de stock</div>
                </div>
            </div>
        `;
                return;
            }

            bajoStock.forEach(insumo => {
                const isCritical = (insumo.categoria === 'Limpieza' && insumo.cantidad < 5) ||
                    (insumo.categoria === 'Oficina' && insumo.cantidad < 2);

                const alertHTML = `
            <div class="alert-item">
                <div class="alert-icon ${isCritical ? 'critical' : 'warning'}">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="alert-info">
                    <div class="alert-title">${insumo.nombre}</div>
                    <div class="alert-message">
                        ${insumo.cantidad} unidades disponibles (${insumo.categoria})
                    </div>
                </div>
                <button class="alert-action" onclick="generateOrder('${insumo.nombre}')">
                    Solicitar
                </button>
            </div>
        `;

                alertList.innerHTML += alertHTML;
            });
        }

        /**
         * Renderiza la tabla de actividad reciente
         */
        function renderActividadReciente() {
            const actividadReciente = document.getElementById('actividadReciente');
            if (!actividadReciente) return;

            actividadReciente.innerHTML = '';

            // Combinar entradas y salidas, ordenar por fecha (m√°s reciente primero)
            const actividades = [];

            entradas.forEach(entrada => {
                actividades.push({
                    fecha: entrada.fecha,
                    tipo: 'Entrada',
                    descripcion: entrada.tipo,
                    items: entrada.items,
                    responsable: entrada.responsable
                });
            });

            salidas.forEach(salida => {
                actividades.push({
                    fecha: salida.fecha,
                    tipo: 'Salida',
                    descripcion: salida.tipo,
                    items: salida.items,
                    responsable: salida.responsable
                });
            });

            // Ordenar por fecha (m√°s reciente primero)
            actividades.sort((a, b) => new Date(b.fecha) - new Date(a.fecha));

            // Limitar a las 10 m√°s recientes
            const recentActivities = actividades.slice(0, 10);

            recentActivities.forEach(actividad => {
                const fechaFormateada = formatDate(actividad.fecha);
                const insumoTexto = actividad.items.length > 0 ?
                    actividad.items[0].nombre + (actividad.items.length > 1 ? ` y ${actividad.items.length - 1} m√°s` : '') :
                    'N/A';

                const cantidadTotal = actividad.items.reduce((total, item) => total + item.cantidad, 0);

                let statusClass = '';
                if (actividad.tipo === 'Entrada') {
                    statusClass = 'success';
                } else {
                    statusClass = 'warning';
                }

                const actividadHTML = `
            <tr>
                <td>${fechaFormateada}</td>
                <td>${actividad.descripcion}</td>
                <td>${insumoTexto}</td>
                <td>${cantidadTotal}</td>
                <td>${actividad.responsable}</td>
                <td><span class="status-badge ${statusClass}">${actividad.tipo}</span></td>
            </tr>
        `;

                actividadReciente.innerHTML += actividadHTML;
            });

            // Si no hay actividades
            if (recentActivities.length === 0) {
                actividadReciente.innerHTML = `
            <tr>
                <td colspan="6" style="text-align: center;">No hay actividad reciente</td>
            </tr>
        `;
            }
        }

        /**
         * Inicializa los gr√°ficos del dashboard y reportes
         */
        function initCharts() {
            initMovimientosChart();
            initCategoriasChart();
            initEvolucionInventarioChart();
            initDistribucionSalidasChart();
        }

        /**
         * Inicializa el gr√°fico de movimientos
         */
        function initMovimientosChart() {
            const ctx = document.getElementById('movimientosChart');
            if (!ctx) return;

            // Obtener datos de los √∫ltimos 7 d√≠as
            const fechas = [];
            const entradasData = [];
            const salidasData = [];

            // Generar fechas para los √∫ltimos 7 d√≠as
            for (let i = 6; i >= 0; i--) {
                const fecha = new Date();
                fecha.setDate(fecha.getDate() - i);
                fechas.push(formatDate(fecha));

                // Contar entradas y salidas para cada fecha
                const entradasDia = entradas.filter(entrada => {
                    const fechaEntrada = new Date(entrada.fecha);
                    return fechaEntrada.toDateString() === fecha.toDateString();
                });

                const salidasDia = salidas.filter(salida => {
                    const fechaSalida = new Date(salida.fecha);
                    return fechaSalida.toDateString() === fecha.toDateString();
                });

                // Sumar las cantidades
                const totalEntradas = entradasDia.reduce((total, entrada) => {
                    return total + entrada.items.reduce((sum, item) => sum + item.cantidad, 0);
                }, 0);

                const totalSalidas = salidasDia.reduce((total, salida) => {
                    return total + salida.items.reduce((sum, item) => sum + item.cantidad, 0);
                }, 0);

                entradasData.push(totalEntradas);
                salidasData.push(totalSalidas);
            }

            // Destruir el gr√°fico anterior si existe
            if (movimientosChart) {
                movimientosChart.destroy();
            }

            // Crear nuevo gr√°fico
            movimientosChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: fechas,
                    datasets: [
                        {
                            label: 'Entradas',
                            data: entradasData,
                            borderColor: '#4cc9f0',
                            backgroundColor: 'rgba(76, 201, 240, 0.1)',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: 'Salidas',
                            data: salidasData,
                            borderColor: '#f72585',
                            backgroundColor: 'rgba(247, 37, 133, 0.1)',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        /**
         * Inicializa el gr√°fico de categor√≠as
         */
        function initCategoriasChart() {
            const ctx = document.getElementById('categoriasChart');
            if (!ctx) return;

            // Contar insumos por categor√≠a
            const categorias = {};
            insumos.forEach(insumo => {
                if (!categorias[insumo.categoria]) {
                    categorias[insumo.categoria] = 0;
                }
                categorias[insumo.categoria] += insumo.cantidad;
            });

            const categoriasLabels = Object.keys(categorias);
            const categoriasCantidades = Object.values(categorias);

            // Colores para las categor√≠as
            const colores = ['#4361ee', '#4cc9f0', '#f72585', '#3f37c9', '#4895ef'];

            // Destruir el gr√°fico anterior si existe
            if (categoriasChart) {
                categoriasChart.destroy();
            }

            // Crear nuevo gr√°fico
            categoriasChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: categoriasLabels,
                    datasets: [
                        {
                            data: categoriasCantidades,
                            backgroundColor: colores,
                            borderWidth: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    },
                    cutout: '65%'
                }
            });
        }

        /**
         * Inicializa el gr√°fico de evoluci√≥n de inventario
         */
        function initEvolucionInventarioChart() {
            const ctx = document.getElementById('evolucionInventarioChart');
            if (!ctx) return;

            // Datos de inventario simulados para los √∫ltimos 6 meses
            const labels = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio'];

            // Opciones de categor√≠as
            const categorias = ['Limpieza', 'Oficina', 'Herramientas'];

            // Generar datos simulados para cada categor√≠a
            const datasets = categorias.map((categoria, index) => {
                const baseValue = 50 + Math.floor(Math.random() * 50);
                const data = labels.map(() => baseValue + Math.floor(Math.random() * 30));

                const colors = [
                    '#4361ee',
                    '#4cc9f0',
                    '#f72585'
                ];

                return {
                    label: categoria,
                    data: data,
                    borderColor: colors[index],
                    backgroundColor: colors[index] + '20',
                    borderWidth: 2,
                    fill: true
                };
            });

            // Destruir el gr√°fico anterior si existe
            if (evolucionInventarioChart) {
                evolucionInventarioChart.destroy();
            }

            // Crear nuevo gr√°fico
            evolucionInventarioChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        /**
         * Inicializa el gr√°fico de distribuci√≥n de salidas
         */
        function initDistribucionSalidasChart() {
            const ctx = document.getElementById('distribucionSalidasChart');
            if (!ctx) return;

            // Contar salidas por tipo
            const tiposSalida = {};
            salidas.forEach(salida => {
                if (!tiposSalida[salida.tipo]) {
                    tiposSalida[salida.tipo] = 0;
                }
                tiposSalida[salida.tipo]++;
            });

            const tiposSalidaLabels = Object.keys(tiposSalida);
            const tiposSalidaCantidades = Object.values(tiposSalida);

            // Colores para los tipos
            const colores = ['#f72585', '#4361ee', '#4cc9f0'];

            // Destruir el gr√°fico anterior si existe
            if (distribucionSalidasChart) {
                distribucionSalidasChart.destroy();
            }

            // Crear nuevo gr√°fico
            distribucionSalidasChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: tiposSalidaLabels,
                    datasets: [
                        {
                            label: 'Cantidad de salidas',
                            data: tiposSalidaCantidades,
                            backgroundColor: colores,
                            borderWidth: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        /**
         * Sincroniza todos los datos con Google Sheets
         */
        async function syncData() {
            showLoader();
            try {
                await loadAllData();
                hideLoader();
                showToast('Datos sincronizados correctamente', 'success');
            } catch (error) {
                console.error('Error sincronizando datos', error);
                hideLoader();
                showToast('Error al sincronizar datos', 'error');
            }
        }

        /**
         * Renderiza la tabla de insumos
         * @param {Array} filteredInsumos - Insumos filtrados (opcional)
         */
        function renderInsumosTable(filteredInsumos) {
            const insumosTable = document.getElementById('insumosTable');
            if (!insumosTable) return;

            const insumosToRender = filteredInsumos || insumos;

            insumosTable.innerHTML = '';

            if (insumosToRender.length === 0) {
                insumosTable.innerHTML = `
            <tr>
                <td colspan="6" style="text-align: center;">No hay insumos registrados</td>
            </tr>
        `;
                return;
            }

            insumosToRender.forEach((insumo, index) => {
                let estadoClass = 'success';
                let estadoText = 'Normal';

                if (insumo.categoria === 'Limpieza' && insumo.cantidad < 10) {
                    estadoClass = insumo.cantidad < 5 ? 'danger' : 'warning';
                    estadoText = insumo.cantidad < 5 ? 'Cr√≠tico' : 'Bajo';
                } else if (insumo.categoria === 'Oficina' && insumo.cantidad < 5) {
                    estadoClass = insumo.cantidad < 2 ? 'danger' : 'warning';
                    estadoText = insumo.cantidad < 2 ? 'Cr√≠tico' : 'Bajo';
                }

                const insumoHTML = `
            <tr>
                <td>${insumo.nombre}</td>
                <td>${insumo.categoria}</td>
                <td>${insumo.cantidad}</td>
                <td>${insumo.ubicacion}</td>
                <td><span class="status-badge ${estadoClass}">${estadoText}</span></td>
                <td class="action-cell">
                    <button class="btn btn-primary btn-sm" onclick="editInsumo(${index})">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="deleteInsumo(${index})">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            </tr>
        `;

                insumosTable.innerHTML += insumoHTML;
            });
        }

        /**
         * Filtra la tabla de insumos seg√∫n los criterios de b√∫squeda
         */
        function filterInsumos() {
            const filtro = document.getElementById('insumoFilter').value;
            const busqueda = document.getElementById('insumoSearch').value.toLowerCase();

            let filteredInsumos = [...insumos];

            // Filtrar por categor√≠a
            if (filtro && filtro !== 'todos') {
                filteredInsumos = filteredInsumos.filter(insumo => insumo.categoria === filtro);
            }

            // Filtrar por t√©rmino de b√∫squeda
            if (busqueda) {
                filteredInsumos = filteredInsumos.filter(insumo =>
                    insumo.nombre.toLowerCase().includes(busqueda) ||
                    insumo.categoria.toLowerCase().includes(busqueda) ||
                    insumo.ubicacion.toLowerCase().includes(busqueda)
                );
            }

            renderInsumosTable(filteredInsumos);
        }

        /**
         * Renderiza la tabla de personal
         * @param {Array} filteredPersonal - Personal filtrado (opcional)
         */
        function renderPersonalTable(filteredPersonal) {
            const personalTable = document.getElementById('personalTable');
            if (!personalTable) return;

            const personalToRender = filteredPersonal || personal;

            personalTable.innerHTML = '';

            if (personalToRender.length === 0) {
                personalTable.innerHTML = `
            <tr>
                <td colspan="5" style="text-align: center;">No hay personal registrado</td>
            </tr>
        `;
                return;
            }

            personalToRender.forEach((persona, index) => {
                const personaHTML = `
            <tr>
                <td>${persona.nombre}</td>
                <td>${persona.cargo}</td>
                <td>${persona.terminal}</td>
                <td>${persona.correo}</td>
                <td class="action-cell">
                    <button class="btn btn-primary btn-sm" onclick="editPersonal(${index})">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="deletePersonal(${index})">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            </tr>
        `;

                personalTable.innerHTML += personaHTML;
            });
        }

        /**
         * Filtra la tabla de personal seg√∫n los criterios de b√∫squeda
         */
        function filterPersonal() {
            const filtro = document.getElementById('personalFilter').value;
            const busqueda = document.getElementById('personalSearch').value.toLowerCase();

            let filteredPersonal = [...personal];

            // Filtrar por cargo
            if (filtro && filtro !== 'todos') {
                filteredPersonal = filteredPersonal.filter(persona => persona.cargo === filtro);
            }

            // Filtrar por t√©rmino de b√∫squeda
            if (busqueda) {
                filteredPersonal = filteredPersonal.filter(persona =>
                    persona.nombre.toLowerCase().includes(busqueda) ||
                    persona.cargo.toLowerCase().includes(busqueda) ||
                    persona.terminal.toLowerCase().includes(busqueda) ||
                    persona.correo.toLowerCase().includes(busqueda)
                );
            }

            renderPersonalTable(filteredPersonal);
        }

        /**
         * Renderiza la tabla de entradas
         * @param {Array} filteredEntradas - Entradas filtradas (opcional)
         */
        function renderEntradasTable(filteredEntradas) {
            const entradasTable = document.getElementById('entradasTable');
            if (!entradasTable) return;

            const entradasToRender = filteredEntradas || entradas;

            entradasTable.innerHTML = '';

            if (entradasToRender.length === 0) {
                entradasTable.innerHTML = `
            <tr>
                <td colspan="6" style="text-align: center;">No hay entradas registradas</td>
            </tr>
        `;
                return;
            }

            entradasToRender.forEach((entrada, index) => {
                const fechaFormateada = formatDate(entrada.fecha);

                const insumoTexto = entrada.items.map(item =>
                    `${item.nombre} (${item.cantidad})`
                ).join(', ');

                const entradaHTML = `
            <tr>
                <td>${fechaFormateada}</td>
                <td>${entrada.tipo}</td>
                <td>${entrada.responsable}</td>
                <td>${entrada.origen}</td>
                <td>${insumoTexto}</td>
                <td class="action-cell">
                    <button class="btn btn-primary btn-sm" onclick="viewEntrada(${index})">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="deleteEntrada(${index})">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            </tr>
        `;

                entradasTable.innerHTML += entradaHTML;
            });
        }

        /**
         * Filtra la tabla de entradas seg√∫n los criterios de b√∫squeda
         */
        function filterEntradas() {
            const filtro = document.getElementById('entradaFilter').value;
            const busqueda = document.getElementById('entradaSearch').value.toLowerCase();

            let filteredEntradas = [...entradas];

            // Filtrar por tipo
            if (filtro && filtro !== 'todos') {
                filteredEntradas = filteredEntradas.filter(entrada => entrada.tipo === filtro);
            }

            // Filtrar por t√©rmino de b√∫squeda
            if (busqueda) {
                filteredEntradas = filteredEntradas.filter(entrada =>
                    entrada.responsable.toLowerCase().includes(busqueda) ||
                    entrada.origen.toLowerCase().includes(busqueda) ||
                    entrada.items.some(item => item.nombre.toLowerCase().includes(busqueda))
                );
            }

            renderEntradasTable(filteredEntradas);
        }

        /**
         * Renderiza la tabla de salidas
         * @param {Array} filteredSalidas - Salidas filtradas (opcional)
         */
        function renderSalidasTable(filteredSalidas) {
            const salidasTable = document.getElementById('salidasTable');
            if (!salidasTable) return;

            const salidasToRender = filteredSalidas || salidas;

            salidasTable.innerHTML = '';

            if (salidasToRender.length === 0) {
                salidasTable.innerHTML = `
            <tr>
                <td colspan="6" style="text-align: center;">No hay salidas registradas</td>
            </tr>
        `;
                return;
            }

            salidasToRender.forEach((salida, index) => {
                const fechaFormateada = formatDate(salida.fecha);

                const insumoTexto = salida.items.map(item =>
                    `${item.nombre} (${item.cantidad})`
                ).join(', ');

                const salidaHTML = `
            <tr>
                <td>${fechaFormateada}</td>
                <td>${salida.tipo}</td>
                <td>${salida.responsable}</td>
                <td>${salida.destino}</td>
                <td>${insumoTexto}</td>
                <td class="action-cell">
                    <button class="btn btn-primary btn-sm" onclick="viewSalida(${index})">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="deleteSalida(${index})">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            </tr>
        `;

                salidasTable.innerHTML += salidaHTML;
            });
        }

        /**
         * Filtra la tabla de salidas seg√∫n los criterios de b√∫squeda
         */
        function filterSalidas() {
            const filtro = document.getElementById('salidaFilter').value;
            const busqueda = document.getElementById('salidaSearch').value.toLowerCase();

            let filteredSalidas = [...salidas];

            // Filtrar por tipo
            if (filtro && filtro !== 'todos') {
                filteredSalidas = filteredSalidas.filter(salida => salida.tipo === filtro);
            }

            // Filtrar por t√©rmino de b√∫squeda
            if (busqueda) {
                filteredSalidas = filteredSalidas.filter(salida =>
                    salida.responsable.toLowerCase().includes(busqueda) ||
                    salida.destino.toLowerCase().includes(busqueda) ||
                    salida.items.some(item => item.nombre.toLowerCase().includes(busqueda))
                );
            }

            renderSalidasTable(filteredSalidas);
        }

        /**
         * Renderiza la tabla de pr√©stamos
         * @param {Array} filteredPrestamos - Pr√©stamos filtrados (opcional)
         */
        function renderPrestamosTable(filteredPrestamos) {
            const prestamosTable = document.getElementById('prestamosTable');
            if (!prestamosTable) return;

            const prestamosToRender = filteredPrestamos || prestamos;

            prestamosTable.innerHTML = '';

            if (prestamosToRender.length === 0) {
                prestamosTable.innerHTML = `
            <tr>
                <td colspan="8" style="text-align: center;">No hay pr√©stamos registrados</td>
            </tr>
        `;
                return;
            }

            prestamosToRender.forEach((prestamo, index) => {
                const fechaFormateada = formatDate(prestamo.fecha);
                const fechaDevolucionFormateada = prestamo.fechaDevolucion ? formatDate(prestamo.fechaDevolucion) : 'No definida';

                const insumoTexto = prestamo.items.map(item =>
                    `${item.nombre} (${item.cantidad})`
                ).join(', ');

                let estadoClass = '';
                if (prestamo.estado === 'Activo') {
                    estadoClass = 'warning';
                } else if (prestamo.estado === 'Devuelto') {
                    estadoClass = 'success';
                } else {
                    estadoClass = 'danger';
                }

                const prestamoHTML = `
            <tr>
                <td>${fechaFormateada}</td>
                <td>${prestamo.tipo}</td>
                <td>${prestamo.terminal}</td>
                <td>${prestamo.contacto}</td>
                <td>${insumoTexto}</td>
                <td>${fechaDevolucionFormateada}</td>
                <td><span class="status-badge ${estadoClass}">${prestamo.estado}</span></td>
                <td class="action-cell">
                    <button class="btn btn-primary btn-sm" onclick="viewPrestamo(${index})">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-success btn-sm" onclick="returnPrestamo(${index})">
                        <i class="fas fa-undo"></i>
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="deletePrestamo(${index})">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            </tr>
        `;

                prestamosTable.innerHTML += prestamoHTML;
            });
        }

        /**
         * Filtra la tabla de pr√©stamos seg√∫n los criterios de b√∫squeda
         */
        function filterPrestamos() {
            const filtro = document.getElementById('prestamoFilter').value;
            const busqueda = document.getElementById('prestamoSearch').value.toLowerCase();

            let filteredPrestamos = [...prestamos];

            // Filtrar por tipo
            if (filtro && filtro !== 'todos') {
                filteredPrestamos = filteredPrestamos.filter(prestamo => prestamo.tipo === filtro);
            }

            // Filtrar por t√©rmino de b√∫squeda
            if (busqueda) {
                filteredPrestamos = filteredPrestamos.filter(prestamo =>
                    prestamo.terminal.toLowerCase().includes(busqueda) ||
                    prestamo.contacto.toLowerCase().includes(busqueda) ||
                    prestamo.items.some(item => item.nombre.toLowerCase().includes(busqueda))
                );
            }

            renderPrestamosTable(filteredPrestamos);
        }

        /**
         * Agrega una fila para entrada de insumos
         * @param {HTMLElement} container - Contenedor para las filas
         */
        function addEntradaRow(container) {
            const row = document.createElement('div');
            row.className = 'input-row';
            row.innerHTML = `
        <select class="form-control insumo-select" required>
            <option value="">Seleccionar insumo</option>
            ${insumos.map(insumo => `<option value="${insumo.nombre}">${insumo.nombre}</option>`).join('')}
        </select>
        <input type="number" class="form-control" placeholder="Cantidad" min="1" required>
        <div class="row-actions">
            <button type="button" class="btn btn-primary btn-add-row"><i class="fas fa-plus"></i></button>
            <button type="button" class="btn btn-danger btn-remove-row"><i class="fas fa-minus"></i></button>
        </div>
    `;

            container.appendChild(row);
        }

        /**
         * Agrega una fila para salida de insumos
         * @param {HTMLElement} container - Contenedor para las filas
         */
        function addSalidaRow(container) {
            const row = document.createElement('div');
            row.className = 'input-row';
            row.innerHTML = `
        <select class="form-control insumo-select" required>
            <option value="">Seleccionar insumo</option>
            ${insumos.map(insumo => `<option value="${insumo.nombre}">${insumo.nombre} (${insumo.cantidad} disponibles)</option>`).join('')}
        </select>
        <input type="number" class="form-control" placeholder="Cantidad" min="1" required>
        <div class="row-actions">
            <button type="button" class="btn btn-primary btn-add-row"><i class="fas fa-plus"></i></button>
            <button type="button" class="btn btn-danger btn-remove-row"><i class="fas fa-minus"></i></button>
        </div>
    `;

            container.appendChild(row);
        }

        /**
         * Agrega una fila para pr√©stamo de insumos
         * @param {HTMLElement} container - Contenedor para las filas
         */
        function addPrestamoRow(container) {
            const row = document.createElement('div');
            row.className = 'input-row';
            row.innerHTML = `
        <select class="form-control insumo-select" required>
            <option value="">Seleccionar insumo</option>
            ${insumos.map(insumo => `<option value="${insumo.nombre}">${insumo.nombre} (${insumo.cantidad} disponibles)</option>`).join('')}
        </select>
        <input type="number" class="form-control" placeholder="Cantidad" min="1" required>
        <div class="row-actions">
            <button type="button" class="btn btn-primary btn-add-row"><i class="fas fa-plus"></i></button>
            <button type="button" class="btn btn-danger btn-remove-row"><i class="fas fa-minus"></i></button>
        </div>
    `;

            container.appendChild(row);
        }

        /**
         * Maneja el env√≠o del formulario de insumos
         * @param {Event} e - Evento del formulario
         */
        async function handleInsumoSubmit(e) {
            e.preventDefault();

            const nombre = document.getElementById('insumoNombre').value;
            const categoria = document.getElementById('insumoCategoria').value;
            const cantidad = parseInt(document.getElementById('insumoCantidad').value);
            const ubicacion = document.getElementById('insumoUbicacion').value;
            const descripcion = document.getElementById('insumoDescripcion').value;

            // Verificar si el insumo ya existe
            const insumoExistente = insumos.findIndex(i => i.nombre.toLowerCase() === nombre.toLowerCase());

            if (insumoExistente !== -1) {
                showToast('El insumo ya existe. Utilice la funci√≥n de edici√≥n para modificarlo.', 'warning');
                return;
            }

            // Crear nuevo insumo
            const nuevoInsumo = {
                nombre,
                categoria,
                cantidad,
                ubicacion,
                descripcion,
                fechaRegistro: new Date().toISOString()
            };

            // Guardar en Google Sheets
            try {
                showLoader();

                await gapi.client.sheets.spreadsheets.values.append({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'insumos!A2:F',
                    valueInputOption: 'RAW',
                    insertDataOption: 'INSERT_ROWS',
                    resource: {
                        values: [[
                            nuevoInsumo.nombre,
                            nuevoInsumo.categoria,
                            nuevoInsumo.cantidad,
                            nuevoInsumo.ubicacion,
                            nuevoInsumo.descripcion,
                            nuevoInsumo.fechaRegistro
                        ]]
                    }
                });

                // Agregar a la lista local
                insumos.push(nuevoInsumo);

                // Actualizar UI
                renderInsumosTable();
                updateDashboard();
                populateSelects();

                // Limpiar formulario
                document.getElementById('insumoForm').reset();

                hideLoader();
                showToast('Insumo registrado correctamente', 'success');

            } catch (error) {
                console.error('Error al registrar insumo', error);
                hideLoader();
                showToast('Error al registrar el insumo', 'error');
            }
        }

        /**
         * Maneja el env√≠o del formulario de entradas
         * @param {Event} e - Evento del formulario
         */
        async function handleEntradaSubmit(e) {
            e.preventDefault();

            const tipo = document.getElementById('entradaTipo').value;
            const fecha = document.getElementById('entradaFecha').value;
            const responsable = document.getElementById('entradaResponsable').value;
            const origen = document.getElementById('entradaOrigen').value;

            // Obtener items de entrada
            const rows = document.querySelectorAll('#entradaItems .input-row');
            const items = [];

            for (const row of rows) {
                const insumoNombre = row.querySelector('.insumo-select').value;
                const cantidad = parseInt(row.querySelector('input[type="number"]').value);

                if (!insumoNombre || isNaN(cantidad) || cantidad <= 0) {
                    showToast('Por favor, complete todos los campos de insumos correctamente', 'warning');
                    return;
                }

                items.push({
                    nombre: insumoNombre,
                    cantidad: cantidad
                });
            }

            if (items.length === 0) {
                showToast('Debe agregar al menos un insumo', 'warning');
                return;
            }

            // Crear nueva entrada
            const nuevaEntrada = {
                tipo,
                fecha,
                responsable,
                origen,
                items
            };

            // Actualizar el inventario
            items.forEach(item => {
                const insumoIndex = insumos.findIndex(i => i.nombre === item.nombre);
                if (insumoIndex !== -1) {
                    insumos[insumoIndex].cantidad += item.cantidad;
                }
            });

            // Guardar en Google Sheets
            try {
                showLoader();

                // Guardar la entrada
                await gapi.client.sheets.spreadsheets.values.append({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'entradas!A2:E',
                    valueInputOption: 'RAW',
                    insertDataOption: 'INSERT_ROWS',
                    resource: {
                        values: [[
                            nuevaEntrada.fecha,
                            nuevaEntrada.tipo,
                            nuevaEntrada.responsable,
                            nuevaEntrada.origen,
                            JSON.stringify(nuevaEntrada.items)
                        ]]
                    }
                });

                // Actualizar inventario
                const insumosValues = insumos.map(insumo => [
                    insumo.nombre,
                    insumo.categoria,
                    insumo.cantidad,
                    insumo.ubicacion,
                    insumo.descripcion,
                    insumo.fechaRegistro
                ]);

                await gapi.client.sheets.spreadsheets.values.update({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'insumos!A2:F' + (insumos.length + 1),
                    valueInputOption: 'RAW',
                    resource: {
                        values: insumosValues
                    }
                });

                // Agregar a la lista local
                entradas.push(nuevaEntrada);

                // Actualizar UI
                renderEntradasTable();
                renderInsumosTable();
                updateDashboard();

                // Limpiar formulario
                document.getElementById('entradaForm').reset();

                // Reiniciar filas de insumos
                const entradaItems = document.getElementById('entradaItems');
                entradaItems.innerHTML = '';
                addEntradaRow(entradaItems);

                hideLoader();
                showToast('Entrada registrada correctamente', 'success');

            } catch (error) {
                console.error('Error al registrar entrada', error);
                hideLoader();
                showToast('Error al registrar la entrada', 'error');
            }
        }

        /**
         * Maneja el env√≠o del formulario de salidas
         * @param {Event} e - Evento del formulario
         */
        async function handleSalidaSubmit(e) {
            e.preventDefault();

            const tipo = document.getElementById('salidaTipo').value;
            const fecha = document.getElementById('salidaFecha').value;
            const responsable = document.getElementById('salidaResponsable').value;
            const destino = document.getElementById('salidaDestino').value;

            // Obtener items de salida
            const rows = document.querySelectorAll('#salidaItems .input-row');
            const items = [];

            for (const row of rows) {
                const insumoNombre = row.querySelector('.insumo-select').value;
                const cantidad = parseInt(row.querySelector('input[type="number"]').value);

                if (!insumoNombre || isNaN(cantidad) || cantidad <= 0) {
                    showToast('Por favor, complete todos los campos de insumos correctamente', 'warning');
                    return;
                }

                // Verificar stock disponible
                const insumo = insumos.find(i => i.nombre === insumoNombre);
                if (!insumo || insumo.cantidad < cantidad) {
                    showToast(`No hay suficiente stock de ${insumoNombre}`, 'warning');
                    return;
                }

                items.push({
                    nombre: insumoNombre,
                    cantidad: cantidad
                });
            }

            if (items.length === 0) {
                showToast('Debe agregar al menos un insumo', 'warning');
                return;
            }

            // Crear nueva salida
            const nuevaSalida = {
                tipo,
                fecha,
                responsable,
                destino,
                items
            };

            // Actualizar el inventario
            items.forEach(item => {
                const insumoIndex = insumos.findIndex(i => i.nombre === item.nombre);
                if (insumoIndex !== -1) {
                    insumos[insumoIndex].cantidad -= item.cantidad;
                }
            });

            // Guardar en Google Sheets
            try {
                showLoader();

                // Guardar la salida
                await gapi.client.sheets.spreadsheets.values.append({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'salidas!A2:E',
                    valueInputOption: 'RAW',
                    insertDataOption: 'INSERT_ROWS',
                    resource: {
                        values: [[
                            nuevaSalida.fecha,
                            nuevaSalida.tipo,
                            nuevaSalida.responsable,
                            nuevaSalida.destino,
                            JSON.stringify(nuevaSalida.items)
                        ]]
                    }
                });

                // Actualizar inventario
                const insumosValues = insumos.map(insumo => [
                    insumo.nombre,
                    insumo.categoria,
                    insumo.cantidad,
                    insumo.ubicacion,
                    insumo.descripcion,
                    insumo.fechaRegistro
                ]);

                await gapi.client.sheets.spreadsheets.values.update({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'insumos!A2:F' + (insumos.length + 1),
                    valueInputOption: 'RAW',
                    resource: {
                        values: insumosValues
                    }
                });

                // Agregar a la lista local
                salidas.push(nuevaSalida);

                // Actualizar UI
                renderSalidasTable();
                renderInsumosTable();
                updateDashboard();

                // Limpiar formulario
                document.getElementById('salidaForm').reset();

                // Reiniciar filas de insumos
                const salidaItems = document.getElementById('salidaItems');
                salidaItems.innerHTML = '';
                addSalidaRow(salidaItems);

                hideLoader();
                showToast('Salida registrada correctamente', 'success');

            } catch (error) {
                console.error('Error al registrar salida', error);
                hideLoader();
                showToast('Error al registrar la salida', 'error');
            }
        }

        /**
         * Maneja el env√≠o del formulario de pr√©stamos
         * @param {Event} e - Evento del formulario
         */
        async function handlePrestamoSubmit(e) {
            e.preventDefault();

            const tipo = document.getElementById('prestamoTipo').value;
            const fecha = document.getElementById('prestamoFecha').value;
            const terminal = document.getElementById('prestamoTerminal').value;
            const contacto = document.getElementById('prestamoContacto').value;
            const fechaDevolucion = document.getElementById('prestamoFechaDevolucion').value;

            // Obtener items del pr√©stamo
            const rows = document.querySelectorAll('#prestamoItems .input-row');
            const items = [];

            for (const row of rows) {
                const insumoNombre = row.querySelector('.insumo-select').value;
                const cantidad = parseInt(row.querySelector('input[type="number"]').value);

                if (!insumoNombre || isNaN(cantidad) || cantidad <= 0) {
                    showToast('Por favor, complete todos los campos de insumos correctamente', 'warning');
                    return;
                }

                // Si es un pr√©stamo otorgado, verificar stock disponible
                if (tipo === 'Otorgado') {
                    const insumo = insumos.find(i => i.nombre === insumoNombre);
                    if (!insumo || insumo.cantidad < cantidad) {
                        showToast(`No hay suficiente stock de ${insumoNombre}`, 'warning');
                        return;
                    }
                }

                items.push({
                    nombre: insumoNombre,
                    cantidad: cantidad
                });
            }

            if (items.length === 0) {
                showToast('Debe agregar al menos un insumo', 'warning');
                return;
            }

            // Crear nuevo pr√©stamo
            const nuevoPrestamo = {
                tipo,
                fecha,
                terminal,
                contacto,
                items,
                fechaDevolucion,
                estado: 'Activo'
            };

            // Actualizar el inventario
            if (tipo === 'Otorgado') {
                // Restar del inventario
                items.forEach(item => {
                    const insumoIndex = insumos.findIndex(i => i.nombre === item.nombre);
                    if (insumoIndex !== -1) {
                        insumos[insumoIndex].cantidad -= item.cantidad;
                    }
                });
            } else {
                // Sumar al inventario
                items.forEach(item => {
                    const insumoIndex = insumos.findIndex(i => i.nombre === item.nombre);
                    if (insumoIndex !== -1) {
                        insumos[insumoIndex].cantidad += item.cantidad;
                    }
                });
            }

            // Guardar en Google Sheets
            try {
                showLoader();

                // Guardar el pr√©stamo
                await gapi.client.sheets.spreadsheets.values.append({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'prestamos!A2:G',
                    valueInputOption: 'RAW',
                    insertDataOption: 'INSERT_ROWS',
                    resource: {
                        values: [[
                            nuevoPrestamo.fecha,
                            nuevoPrestamo.tipo,
                            nuevoPrestamo.terminal,
                            nuevoPrestamo.contacto,
                            JSON.stringify(nuevoPrestamo.items),
                            nuevoPrestamo.fechaDevolucion,
                            nuevoPrestamo.estado
                        ]]
                    }
                });

                // Actualizar inventario
                const insumosValues = insumos.map(insumo => [
                    insumo.nombre,
                    insumo.categoria,
                    insumo.cantidad,
                    insumo.ubicacion,
                    insumo.descripcion,
                    insumo.fechaRegistro
                ]);

                await gapi.client.sheets.spreadsheets.values.update({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'insumos!A2:F' + (insumos.length + 1),
                    valueInputOption: 'RAW',
                    resource: {
                        values: insumosValues
                    }
                });

                // Agregar a la lista local
                prestamos.push(nuevoPrestamo);

                // Actualizar UI
                renderPrestamosTable();
                renderInsumosTable();
                updateDashboard();

                // Limpiar formulario
                document.getElementById('prestamoForm').reset();

                // Reiniciar filas de insumos
                const prestamoItems = document.getElementById('prestamoItems');
                prestamoItems.innerHTML = '';
                addPrestamoRow(prestamoItems);

                hideLoader();
                showToast('Pr√©stamo registrado correctamente', 'success');

            } catch (error) {
                console.error('Error al registrar pr√©stamo', error);
                hideLoader();
                showToast('Error al registrar el pr√©stamo', 'error');
            }
        }

        /**
         * Maneja el env√≠o del formulario de personal
         * @param {Event} e - Evento del formulario
         */
        async function handlePersonalSubmit(e) {
            e.preventDefault();

            const nombre = document.getElementById('personalNombre').value;
            const cargo = document.getElementById('personalCargo').value;
            const terminal = document.getElementById('personalTerminal').value;
            const correo = document.getElementById('personalCorreo').value;
            const notas = document.getElementById('personalNotas').value;

            // Verificar si la persona ya existe
            const personaExistente = personal.findIndex(p => p.nombre.toLowerCase() === nombre.toLowerCase());

            if (personaExistente !== -1) {
                showToast('La persona ya existe. Utilice la funci√≥n de edici√≥n para modificarla.', 'warning');
                return;
            }

            // Crear nueva persona
            const nuevaPersona = {
                nombre,
                cargo,
                terminal,
                correo,
                notas
            };

            // Guardar en Google Sheets
            try {
                showLoader();

                await gapi.client.sheets.spreadsheets.values.append({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'personal!A2:E',
                    valueInputOption: 'RAW',
                    insertDataOption: 'INSERT_ROWS',
                    resource: {
                        values: [[
                            nuevaPersona.nombre,
                            nuevaPersona.cargo,
                            nuevaPersona.terminal,
                            nuevaPersona.correo,
                            nuevaPersona.notas
                        ]]
                    }
                });

                // Agregar a la lista local
                personal.push(nuevaPersona);

                // Actualizar UI
                renderPersonalTable();
                populateSelects();

                // Limpiar formulario
                document.getElementById('personalForm').reset();

                hideLoader();
                showToast('Personal registrado correctamente', 'success');

            } catch (error) {
                console.error('Error al registrar personal', error);
                hideLoader();
                showToast('Error al registrar el personal', 'error');
            }
        }

        /**
         * Maneja el env√≠o del formulario de reportes
         * @param {Event} e - Evento del formulario
         */
        function handleReporteSubmit(e) {
            e.preventDefault();

            const tipo = document.getElementById('reporteTipo').value;
            const fechaInicio = document.getElementById('reporteFechaInicio').value;
            const fechaFin = document.getElementById('reporteFechaFin').value;
            const categoria = document.getElementById('reporteCategoria').value;

            if (!tipo) {
                showToast('Debe seleccionar un tipo de reporte', 'warning');
                return;
            }

            // Generar reporte seg√∫n el tipo
            switch (tipo) {
                case 'insumos':
                    generateInsumosReport(categoria);
                    break;
                case 'movimientos':
                    generateMovimientosReport(fechaInicio, fechaFin, categoria);
                    break;
                case 'prestamos':
                    generatePrestamosReport(fechaInicio, fechaFin);
                    break;
                case 'bajoStock':
                    generateBajoStockReport(categoria);
                    break;
                default:
                    showToast('Tipo de reporte no v√°lido', 'warning');
            }
        }

        /**
         * Genera un reporte de insumos
         * @param {string} categoria - Categor√≠a de insumos a filtrar
         */
        function generateInsumosReport(categoria) {
            const reporteResultados = document.getElementById('reporteResultados');
            if (!reporteResultados) return;

            reporteResultados.innerHTML = '';

            let insumosReporte = [...insumos];

            // Filtrar por categor√≠a si se especifica
            if (categoria) {
                insumosReporte = insumosReporte.filter(insumo => insumo.categoria === categoria);
            }

            if (insumosReporte.length === 0) {
                reporteResultados.innerHTML = `
            <tr>
                <td colspan="6" style="text-align: center;">No hay insumos que coincidan con los criterios</td>
            </tr>
        `;
                showToast('Reporte generado sin resultados', 'info');
                return;
            }

            // Ordenar por nombre
            insumosReporte.sort((a, b) => a.nombre.localeCompare(b.nombre));

            insumosReporte.forEach(insumo => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
            <td>${insumo.nombre}</td>
            <td>${insumo.categoria}</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>${insumo.cantidad}</td>
        `;
                reporteResultados.appendChild(tr);
            });

            showToast('Reporte de inventario generado correctamente', 'success');
        }

        /**
         * Genera un reporte de movimientos
         * @param {string} fechaInicio - Fecha de inicio del reporte
         * @param {string} fechaFin - Fecha de fin del reporte
         * @param {string} categoria - Categor√≠a de insumos a filtrar
         */
        function generateMovimientosReport(fechaInicio, fechaFin, categoria) {
            const reporteResultados = document.getElementById('reporteResultados');
            if (!reporteResultados) return;

            reporteResultados.innerHTML = '';

            // Convertir fechas
            const inicio = fechaInicio ? new Date(fechaInicio) : new Date(0);
            const fin = fechaFin ? new Date(fechaFin) : new Date();
            fin.setHours(23, 59, 59); // Incluir todo el d√≠a de fin

            // Obtener todos los insumos que han tenido movimiento
            const insumosConMovimiento = new Map();

            // Inicializar con todos los insumos actuales
            insumos.forEach(insumo => {
                if (!categoria || insumo.categoria === categoria) {
                    insumosConMovimiento.set(insumo.nombre, {
                        nombre: insumo.nombre,
                        categoria: insumo.categoria,
                        stockInicial: 0,
                        entradas: 0,
                        salidas: 0,
                        stockActual: insumo.cantidad
                    });
                }
            });

            // Procesar entradas
            entradas.forEach(entrada => {
                const fechaEntrada = new Date(entrada.fecha);
                if (fechaEntrada >= inicio && fechaEntrada <= fin) {
                    entrada.items.forEach(item => {
                        // Si el insumo no est√° en el mapa y no hay filtro o coincide con el filtro
                        const insumo = insumos.find(i => i.nombre === item.nombre);
                        if (insumo && (!categoria || insumo.categoria === categoria)) {
                            if (!insumosConMovimiento.has(item.nombre)) {
                                insumosConMovimiento.set(item.nombre, {
                                    nombre: item.nombre,
                                    categoria: insumo.categoria,
                                    stockInicial: 0,
                                    entradas: 0,
                                    salidas: 0,
                                    stockActual: insumo.cantidad
                                });
                            }

                            const movimiento = insumosConMovimiento.get(item.nombre);
                            movimiento.entradas += item.cantidad;
                        }
                    });
                }
            });

            // Procesar salidas
            salidas.forEach(salida => {
                const fechaSalida = new Date(salida.fecha);
                if (fechaSalida >= inicio && fechaSalida <= fin) {
                    salida.items.forEach(item => {
                        // Si el insumo no est√° en el mapa y no hay filtro o coincide con el filtro
                        const insumo = insumos.find(i => i.nombre === item.nombre);
                        if (insumo && (!categoria || insumo.categoria === categoria)) {
                            if (!insumosConMovimiento.has(item.nombre)) {
                                insumosConMovimiento.set(item.nombre, {
                                    nombre: item.nombre,
                                    categoria: insumo.categoria,
                                    stockInicial: 0,
                                    entradas: 0,
                                    salidas: 0,
                                    stockActual: insumo.cantidad
                                });
                            }

                            const movimiento = insumosConMovimiento.get(item.nombre);
                            movimiento.salidas += item.cantidad;
                        }
                    });
                }
            });

            // Calcular stock inicial restando entradas y sumando salidas del stock actual
            insumosConMovimiento.forEach(movimiento => {
                movimiento.stockInicial = movimiento.stockActual - movimiento.entradas + movimiento.salidas;
            });

            // Verificar si hay resultados
            if (insumosConMovimiento.size === 0) {
                reporteResultados.innerHTML = `
            <tr>
                <td colspan="6" style="text-align: center;">No hay movimientos que coincidan con los criterios</td>
            </tr>
        `;
                showToast('Reporte generado sin resultados', 'info');
                return;
            }

            // Ordenar por nombre
            const movimientosOrdenados = Array.from(insumosConMovimiento.values()).sort((a, b) => a.nombre.localeCompare(b.nombre));

            // Generar filas del reporte
            movimientosOrdenados.forEach(movimiento => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
            <td>${movimiento.nombre}</td>
            <td>${movimiento.categoria}</td>
            <td>${movimiento.stockInicial}</td>
            <td>${movimiento.entradas}</td>
            <td>${movimiento.salidas}</td>
            <td>${movimiento.stockActual}</td>
        `;
                reporteResultados.appendChild(tr);
            });

            showToast('Reporte de movimientos generado correctamente', 'success');
        }

        /**
         * Genera un reporte de pr√©stamos
         * @param {string} fechaInicio - Fecha de inicio del reporte
         * @param {string} fechaFin - Fecha de fin del reporte
         */
        function generatePrestamosReport(fechaInicio, fechaFin) {
            const reporteResultados = document.getElementById('reporteResultados');
            if (!reporteResultados) return;

            // Cambiar los encabezados de la tabla para prestamos
            const reporteTable = document.getElementById('reporteTable');
            if (reporteTable) {
                const thead = reporteTable.querySelector('thead');
                if (thead) {
                    thead.innerHTML = `
                <tr>
                    <th>Fecha</th>
                    <th>Tipo</th>
                    <th>Terminal</th>
                    <th>Insumo</th>
                    <th>Cantidad</th>
                    <th>Estado</th>
                </tr>
            `;
                }
            }

            reporteResultados.innerHTML = '';

            // Convertir fechas
            const inicio = fechaInicio ? new Date(fechaInicio) : new Date(0);
            const fin = fechaFin ? new Date(fechaFin) : new Date();
            fin.setHours(23, 59, 59); // Incluir todo el d√≠a de fin

            // Filtrar pr√©stamos por fecha
            const prestamosFiltrados = prestamos.filter(prestamo => {
                const fechaPrestamo = new Date(prestamo.fecha);
                return fechaPrestamo >= inicio && fechaPrestamo <= fin;
            });

            if (prestamosFiltrados.length === 0) {
                reporteResultados.innerHTML = `
            <tr>
                <td colspan="6" style="text-align: center;">No hay pr√©stamos que coincidan con los criterios</td>
            </tr>
        `;
                showToast('Reporte generado sin resultados', 'info');
                return;
            }

            // Generar filas expandidas (un insumo por fila)
            prestamosFiltrados.forEach(prestamo => {
                const fechaFormateada = formatDate(prestamo.fecha);

                prestamo.items.forEach(item => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                <td>${fechaFormateada}</td>
                <td>${prestamo.tipo}</td>
                <td>${prestamo.terminal}</td>
                <td>${item.nombre}</td>
                <td>${item.cantidad}</td>
                <td>${prestamo.estado}</td>
            `;
                    reporteResultados.appendChild(tr);
                });
            });

            showToast('Reporte de pr√©stamos generado correctamente', 'success');
        }

        /**
         * Genera un reporte de insumos en bajo stock
         * @param {string} categoria - Categor√≠a de insumos a filtrar
         */
        function generateBajoStockReport(categoria) {
            const reporteResultados = document.getElementById('reporteResultados');
            if (!reporteResultados) return;

            reporteResultados.innerHTML = '';

            // Filtrar insumos en bajo stock
            const bajoStock = insumos.filter(insumo => {
                if (categoria && insumo.categoria !== categoria) return false;

                if (insumo.categoria === 'Limpieza' && insumo.cantidad < 10) return true;
                if (insumo.categoria === 'Oficina' && insumo.cantidad < 5) return true;
                return false;
            });

            if (bajoStock.length === 0) {
                reporteResultados.innerHTML = `
            <tr>
                <td colspan="6" style="text-align: center;">No hay insumos en bajo stock que coincidan con los criterios</td>
            </tr>
        `;
                showToast('Reporte generado sin resultados', 'info');
                return;
            }

            // Ordenar por cantidad ascendente (menor a mayor)
            bajoStock.sort((a, b) => a.cantidad - b.cantidad);

            bajoStock.forEach(insumo => {
                const tr = document.createElement('tr');

                // Determinar nivel cr√≠tico
                let nivelCritico = 'Normal';
                if (insumo.categoria === 'Limpieza' && insumo.cantidad < 10) {
                    nivelCritico = insumo.cantidad < 5 ? 'Cr√≠tico' : 'Bajo';
                } else if (insumo.categoria === 'Oficina' && insumo.cantidad < 5) {
                    nivelCritico = insumo.cantidad < 2 ? 'Cr√≠tico' : 'Bajo';
                }

                tr.innerHTML = `
            <td>${insumo.nombre}</td>
            <td>${insumo.categoria}</td>
            <td>-</td>
            <td>-</td>
            <td>${nivelCritico}</td>
            <td>${insumo.cantidad}</td>
        `;
                reporteResultados.appendChild(tr);
            });

            showToast('Reporte de bajo stock generado correctamente', 'success');
        }

        /**
         * Edita un insumo existente
         * @param {number} index - √çndice del insumo en el array
         */
        function editInsumo(index) {
            const insumo = insumos[index];
            if (!insumo) return;

            // Rellenar el formulario con los datos del insumo
            document.getElementById('insumoNombre').value = insumo.nombre;
            document.getElementById('insumoCategoria').value = insumo.categoria;
            document.getElementById('insumoCantidad').value = insumo.cantidad;
            document.getElementById('insumoUbicacion').value = insumo.ubicacion;
            document.getElementById('insumoDescripcion').value = insumo.descripcion;

            // Scroll al formulario
            document.getElementById('insumoForm').scrollIntoView({ behavior: 'smooth' });

            // Cambiar el bot√≥n de submit
            const submitBtn = document.getElementById('insumoForm').querySelector('button[type="submit"]');
            submitBtn.textContent = 'Actualizar Insumo';

            // Guardar el √≠ndice para la actualizaci√≥n
            submitBtn.dataset.editIndex = index;

            // Cambiar el manejador del evento
            document.getElementById('insumoForm').removeEventListener('submit', handleInsumoSubmit);
            document.getElementById('insumoForm').addEventListener('submit', handleInsumoUpdate);

            showToast(`Editando insumo: ${insumo.nombre}`, 'info');
        }

        /**
         * Maneja la actualizaci√≥n de un insumo existente
         * @param {Event} e - Evento del formulario
         */
        async function handleInsumoUpdate(e) {
            e.preventDefault();

            const index = parseInt(e.target.querySelector('button[type="submit"]').dataset.editIndex);
            if (isNaN(index) || !insumos[index]) {
                showToast('Error al actualizar: insumo no encontrado', 'error');
                return;
            }

            const nombre = document.getElementById('insumoNombre').value;
            const categoria = document.getElementById('insumoCategoria').value;
            const cantidad = parseInt(document.getElementById('insumoCantidad').value);
            const ubicacion = document.getElementById('insumoUbicacion').value;
            const descripcion = document.getElementById('insumoDescripcion').value;

            // Actualizar insumo
            insumos[index] = {
                ...insumos[index],
                nombre,
                categoria,
                cantidad,
                ubicacion,
                descripcion
            };

            // Guardar en Google Sheets
            try {
                showLoader();

                const insumosValues = insumos.map(insumo => [
                    insumo.nombre,
                    insumo.categoria,
                    insumo.cantidad,
                    insumo.ubicacion,
                    insumo.descripcion,
                    insumo.fechaRegistro
                ]);

                await gapi.client.sheets.spreadsheets.values.update({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'insumos!A2:F' + (insumos.length + 1),
                    valueInputOption: 'RAW',
                    resource: {
                        values: insumosValues
                    }
                });

                // Actualizar UI
                renderInsumosTable();
                updateDashboard();
                populateSelects();

                // Resetear formulario
                document.getElementById('insumoForm').reset();

                // Restaurar bot√≥n de submit
                const submitBtn = document.getElementById('insumoForm').querySelector('button[type="submit"]');
                submitBtn.textContent = 'Guardar Insumo';
                delete submitBtn.dataset.editIndex;

                // Restaurar el manejador del evento
                document.getElementById('insumoForm').removeEventListener('submit', handleInsumoUpdate);
                document.getElementById('insumoForm').addEventListener('submit', handleInsumoSubmit);

                hideLoader();
                showToast('Insumo actualizado correctamente', 'success');

            } catch (error) {
                console.error('Error al actualizar insumo', error);
                hideLoader();
                showToast('Error al actualizar el insumo', 'error');
            }
        }

        /**
         * Elimina un insumo
         * @param {number} index - √çndice del insumo en el array
         */
        async function deleteInsumo(index) {
            const insumo = insumos[index];
            if (!insumo) return;

            if (!confirm(`¬øEst√° seguro de eliminar el insumo "${insumo.nombre}"?`)) {
                return;
            }

            try {
                showLoader();

                // Eliminar de la lista local
                insumos.splice(index, 1);

                // Actualizar en Google Sheets
                const insumosValues = insumos.map(insumo => [
                    insumo.nombre,
                    insumo.categoria,
                    insumo.cantidad,
                    insumo.ubicacion,
                    insumo.descripcion,
                    insumo.fechaRegistro
                ]);

                // Si no hay insumos, limpiar la hoja
                if (insumosValues.length === 0) {
                    await gapi.client.sheets.spreadsheets.values.clear({
                        spreadsheetId: SPREADSHEET_ID,
                        range: 'insumos!A2:F'
                    });
                } else {
                    await gapi.client.sheets.spreadsheets.values.update({
                        spreadsheetId: SPREADSHEET_ID,
                        range: 'insumos!A2:F' + (insumosValues.length + 1),
                        valueInputOption: 'RAW',
                        resource: {
                            values: insumosValues
                        }
                    });
                }

                // Actualizar UI
                renderInsumosTable();
                updateDashboard();
                populateSelects();

                hideLoader();
                showToast(`Insumo "${insumo.nombre}" eliminado correctamente`, 'success');

            } catch (error) {
                console.error('Error al eliminar insumo', error);
                hideLoader();
                showToast('Error al eliminar el insumo', 'error');
            }
        }

        /**
         * Edita un personal existente
         * @param {number} index - √çndice del personal en el array
         */
        function editPersonal(index) {
            const persona = personal[index];
            if (!persona) return;

            // Rellenar el formulario con los datos de la persona
            document.getElementById('personalNombre').value = persona.nombre;
            document.getElementById('personalCargo').value = persona.cargo;
            document.getElementById('personalTerminal').value = persona.terminal;
            document.getElementById('personalCorreo').value = persona.correo;
            document.getElementById('personalNotas').value = persona.notas;

            // Scroll al formulario
            document.getElementById('personalForm').scrollIntoView({ behavior: 'smooth' });

            // Cambiar el bot√≥n de submit
            const submitBtn = document.getElementById('personalForm').querySelector('button[type="submit"]');
            submitBtn.textContent = 'Actualizar Personal';

            // Guardar el √≠ndice para la actualizaci√≥n
            submitBtn.dataset.editIndex = index;

            // Cambiar el manejador del evento
            document.getElementById('personalForm').removeEventListener('submit', handlePersonalSubmit);
            document.getElementById('personalForm').addEventListener('submit', handlePersonalUpdate);

            showToast(`Editando personal: ${persona.nombre}`, 'info');
        }

        /**
         * Maneja la actualizaci√≥n de un personal existente
         * @param {Event} e - Evento del formulario
         */
        async function handlePersonalUpdate(e) {
            e.preventDefault();

            const index = parseInt(e.target.querySelector('button[type="submit"]').dataset.editIndex);
            if (isNaN(index) || !personal[index]) {
                showToast('Error al actualizar: personal no encontrado', 'error');
                return;
            }

            const nombre = document.getElementById('personalNombre').value;
            const cargo = document.getElementById('personalCargo').value;
            const terminal = document.getElementById('personalTerminal').value;
            const correo = document.getElementById('personalCorreo').value;
            const notas = document.getElementById('personalNotas').value;

            // Actualizar personal
            personal[index] = {
                ...personal[index],
                nombre,
                cargo,
                terminal,
                correo,
                notas
            };

            // Guardar en Google Sheets
            try {
                showLoader();

                const personalValues = personal.map(persona => [
                    persona.nombre,
                    persona.cargo,
                    persona.terminal,
                    persona.correo,
                    persona.notas
                ]);

                await gapi.client.sheets.spreadsheets.values.update({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'personal!A2:E' + (personal.length + 1),
                    valueInputOption: 'RAW',
                    resource: {
                        values: personalValues
                    }
                });

                // Actualizar UI
                renderPersonalTable();
                populateSelects();

                // Resetear formulario
                document.getElementById('personalForm').reset();

                // Restaurar bot√≥n de submit
                const submitBtn = document.getElementById('personalForm').querySelector('button[type="submit"]');
                submitBtn.textContent = 'Guardar Personal';
                delete submitBtn.dataset.editIndex;

                // Restaurar el manejador del evento
                document.getElementById('personalForm').removeEventListener('submit', handlePersonalUpdate);
                document.getElementById('personalForm').addEventListener('submit', handlePersonalSubmit);

                hideLoader();
                showToast('Personal actualizado correctamente', 'success');

            } catch (error) {
                console.error('Error al actualizar personal', error);
                hideLoader();
                showToast('Error al actualizar el personal', 'error');
            }
        }

        /**
         * Elimina un personal
         * @param {number} index - √çndice del personal en el array
         */
        async function deletePersonal(index) {
            const persona = personal[index];
            if (!persona) return;

            if (!confirm(`¬øEst√° seguro de eliminar al personal "${persona.nombre}"?`)) {
                return;
            }

            try {
                showLoader();

                // Eliminar de la lista local
                personal.splice(index, 1);

                // Actualizar en Google Sheets
                const personalValues = personal.map(persona => [
                    persona.nombre,
                    persona.cargo,
                    persona.terminal,
                    persona.correo,
                    persona.notas
                ]);

                // Si no hay personal, limpiar la hoja
                if (personalValues.length === 0) {
                    await gapi.client.sheets.spreadsheets.values.clear({
                        spreadsheetId: SPREADSHEET_ID,
                        range: 'personal!A2:E'
                    });
                } else {
                    await gapi.client.sheets.spreadsheets.values.update({
                        spreadsheetId: SPREADSHEET_ID,
                        range: 'personal!A2:E' + (personalValues.length + 1),
                        valueInputOption: 'RAW',
                        resource: {
                            values: personalValues
                        }
                    });
                }

                // Actualizar UI
                renderPersonalTable();
                populateSelects();

                hideLoader();
                showToast(`Personal "${persona.nombre}" eliminado correctamente`, 'success');

            } catch (error) {
                console.error('Error al eliminar personal', error);
                hideLoader();
                showToast('Error al eliminar el personal', 'error');
            }
        }

        /**
         * Ver detalles de una entrada
         * @param {number} index - √çndice de la entrada en el array
         */
        function viewEntrada(index) {
            const entrada = entradas[index];
            if (!entrada) return;

            let itemsHtml = '';
            entrada.items.forEach(item => {
                itemsHtml += `<li>${item.nombre}: ${item.cantidad} unidades</li>`;
            });

            const message = `
        <div>
            <p><strong>Fecha:</strong> ${formatDate(entrada.fecha)}</p>
            <p><strong>Tipo:</strong> ${entrada.tipo}</p>
            <p><strong>Responsable:</strong> ${entrada.responsable}</p>
            <p><strong>Origen/Proveedor:</strong> ${entrada.origen}</p>
            <p><strong>Insumos:</strong></p>
            <ul>${itemsHtml}</ul>
        </div>
    `;

            showToast(message, 'info', 10000); // Mostrar por m√°s tiempo (10 segundos)
        }

        /**
         * Eliminar una entrada
         * @param {number} index - √çndice de la entrada en el array
         */
        async function deleteEntrada(index) {
            const entrada = entradas[index];
            if (!entrada) return;

            if (!confirm(`¬øEst√° seguro de eliminar esta entrada? Esta acci√≥n afectar√° el inventario.`)) {
                return;
            }

            try {
                showLoader();

                // Actualizar inventario (restar lo que se hab√≠a sumado)
                entrada.items.forEach(item => {
                    const insumoIndex = insumos.findIndex(i => i.nombre === item.nombre);
                    if (insumoIndex !== -1) {
                        insumos[insumoIndex].cantidad -= item.cantidad;
                        // Asegurar que no quede negativo
                        if (insumos[insumoIndex].cantidad < 0) {
                            insumos[insumoIndex].cantidad = 0;
                        }
                    }
                });

                // Eliminar de la lista local
                entradas.splice(index, 1);

                // Actualizar entradas en Google Sheets
                const entradasValues = entradas.map(entrada => [
                    entrada.fecha,
                    entrada.tipo,
                    entrada.responsable,
                    entrada.origen,
                    JSON.stringify(entrada.items)
                ]);

                // Si no hay entradas, limpiar la hoja
                if (entradasValues.length === 0) {
                    await gapi.client.sheets.spreadsheets.values.clear({
                        spreadsheetId: SPREADSHEET_ID,
                        range: 'entradas!A2:E'
                    });
                } else {
                    await gapi.client.sheets.spreadsheets.values.update({
                        spreadsheetId: SPREADSHEET_ID,
                        range: 'entradas!A2:E' + (entradasValues.length + 1),
                        valueInputOption: 'RAW',
                        resource: {
                            values: entradasValues
                        }
                    });
                }

                // Actualizar inventario en Google Sheets
                const insumosValues = insumos.map(insumo => [
                    insumo.nombre,
                    insumo.categoria,
                    insumo.cantidad,
                    insumo.ubicacion,
                    insumo.descripcion,
                    insumo.fechaRegistro
                ]);

                await gapi.client.sheets.spreadsheets.values.update({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'insumos!A2:F' + (insumos.length + 1),
                    valueInputOption: 'RAW',
                    resource: {
                        values: insumosValues
                    }
                });

                // Actualizar UI
                renderEntradasTable();
                renderInsumosTable();
                updateDashboard();

                hideLoader();
                showToast('Entrada eliminada correctamente', 'success');

            } catch (error) {
                console.error('Error al eliminar entrada', error);
                hideLoader();
                showToast('Error al eliminar la entrada', 'error');
            }
        }

        /**
         * Ver detalles de una salida
         * @param {number} index - √çndice de la salida en el array
         */
        function viewSalida(index) {
            const salida = salidas[index];
            if (!salida) return;

            let itemsHtml = '';
            salida.items.forEach(item => {
                itemsHtml += `<li>${item.nombre}: ${item.cantidad} unidades</li>`;
            });

            const message = `
        <div>
            <p><strong>Fecha:</strong> ${formatDate(salida.fecha)}</p>
            <p><strong>Tipo:</strong> ${salida.tipo}</p>
            <p><strong>Responsable:</strong> ${salida.responsable}</p>
            <p><strong>Destinatario:</strong> ${salida.destino}</p>
            <p><strong>Insumos:</strong></p>
            <ul>${itemsHtml}</ul>
        </div>
    `;

            showToast(message, 'info', 10000); // Mostrar por m√°s tiempo (10 segundos)
        }

        /**
         * Eliminar una salida
         * @param {number} index - √çndice de la salida en el array
         */
        async function deleteSalida(index) {
            const salida = salidas[index];
            if (!salida) return;

            if (!confirm(`¬øEst√° seguro de eliminar esta salida? Esta acci√≥n afectar√° el inventario.`)) {
                return;
            }

            try {
                showLoader();

                // Actualizar inventario (sumar lo que se hab√≠a restado)
                salida.items.forEach(item => {
                    const insumoIndex = insumos.findIndex(i => i.nombre === item.nombre);
                    if (insumoIndex !== -1) {
                        insumos[insumoIndex].cantidad += item.cantidad;
                    }
                });

                // Eliminar de la lista local
                salidas.splice(index, 1);

                // Actualizar salidas en Google Sheets
                const salidasValues = salidas.map(salida => [
                    salida.fecha,
                    salida.tipo,
                    salida.responsable,
                    salida.destino,
                    JSON.stringify(salida.items)
                ]);

                // Si no hay salidas, limpiar la hoja
                if (salidasValues.length === 0) {
                    await gapi.client.sheets.spreadsheets.values.clear({
                        spreadsheetId: SPREADSHEET_ID,
                        range: 'salidas!A2:E'
                    });
                } else {
                    await gapi.client.sheets.spreadsheets.values.update({
                        spreadsheetId: SPREADSHEET_ID,
                        range: 'salidas!A2:E' + (salidasValues.length + 1),
                        valueInputOption: 'RAW',
                        resource: {
                            values: salidasValues
                        }
                    });
                }

                // Actualizar inventario en Google Sheets
                const insumosValues = insumos.map(insumo => [
                    insumo.nombre,
                    insumo.categoria,
                    insumo.cantidad,
                    insumo.ubicacion,
                    insumo.descripcion,
                    insumo.fechaRegistro
                ]);

                await gapi.client.sheets.spreadsheets.values.update({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'insumos!A2:F' + (insumos.length + 1),
                    valueInputOption: 'RAW',
                    resource: {
                        values: insumosValues
                    }
                });

                // Actualizar UI
                renderSalidasTable();
                renderInsumosTable();
                updateDashboard();

                hideLoader();
                showToast('Salida eliminada correctamente', 'success');

            } catch (error) {
                console.error('Error al eliminar salida', error);
                hideLoader();
                showToast('Error al eliminar la salida', 'error');
            }
        }

        /**
         * Ver detalles de un pr√©stamo
         * @param {number} index - √çndice del pr√©stamo en el array
         */
        function viewPrestamo(index) {
            const prestamo = prestamos[index];
            if (!prestamo) return;

            let itemsHtml = '';
            prestamo.items.forEach(item => {
                itemsHtml += `<li>${item.nombre}: ${item.cantidad} unidades</li>`;
            });

            const fechaDevolucionFormateada = prestamo.fechaDevolucion ? formatDate(prestamo.fechaDevolucion) : 'No definida';

            const message = `
        <div>
            <p><strong>Fecha:</strong> ${formatDate(prestamo.fecha)}</p>
            <p><strong>Tipo:</strong> ${prestamo.tipo}</p>
            <p><strong>Terminal:</strong> ${prestamo.terminal}</p>
            <p><strong>Contacto:</strong> ${prestamo.contacto}</p>
            <p><strong>Fecha de devoluci√≥n:</strong> ${fechaDevolucionFormateada}</p>
            <p><strong>Estado:</strong> ${prestamo.estado}</p>
            <p><strong>Insumos:</strong></p>
            <ul>${itemsHtml}</ul>
        </div>
    `;

            showToast(message, 'info', 10000); // Mostrar por m√°s tiempo (10 segundos)
        }

        /**
         * Marca un pr√©stamo como devuelto
         * @param {number} index - √çndice del pr√©stamo en el array
         */
        async function returnPrestamo(index) {
            const prestamo = prestamos[index];
            if (!prestamo) return;

            if (prestamo.estado !== 'Activo') {
                showToast(`Este pr√©stamo ya est√° marcado como ${prestamo.estado}`, 'warning');
                return;
            }

            try {
                showLoader();

                // Actualizar inventario
                if (prestamo.tipo === 'Otorgado') {
                    // Si fue otorgado, al devolverlo se suma al inventario
                    prestamo.items.forEach(item => {
                        const insumoIndex = insumos.findIndex(i => i.nombre === item.nombre);
                        if (insumoIndex !== -1) {
                            insumos[insumoIndex].cantidad += item.cantidad;
                        }
                    });
                } else {
                    // Si fue recibido, al devolverlo se resta del inventario
                    prestamo.items.forEach(item => {
                        const insumoIndex = insumos.findIndex(i => i.nombre === item.nombre);
                        if (insumoIndex !== -1) {
                            insumos[insumoIndex].cantidad -= item.cantidad;
                            // Asegurar que no quede negativo
                            if (insumos[insumoIndex].cantidad < 0) {
                                insumos[insumoIndex].cantidad = 0;
                            }
                        }
                    });
                }

                // Actualizar estado del pr√©stamo
                prestamos[index].estado = 'Devuelto';
                prestamos[index].fechaDevolucion = prestamos[index].fechaDevolucion || new Date().toISOString().split('T')[0];

                // Actualizar pr√©stamos en Google Sheets
                const prestamosValues = prestamos.map(prestamo => [
                    prestamo.fecha,
                    prestamo.tipo,
                    prestamo.terminal,
                    prestamo.contacto,
                    JSON.stringify(prestamo.items),
                    prestamo.fechaDevolucion,
                    prestamo.estado
                ]);

                await gapi.client.sheets.spreadsheets.values.update({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'prestamos!A2:G' + (prestamos.length + 1),
                    valueInputOption: 'RAW',
                    resource: {
                        values: prestamosValues
                    }
                });

                // Actualizar inventario en Google Sheets
                const insumosValues = insumos.map(insumo => [
                    insumo.nombre,
                    insumo.categoria,
                    insumo.cantidad,
                    insumo.ubicacion,
                    insumo.descripcion,
                    insumo.fechaRegistro
                ]);

                await gapi.client.sheets.spreadsheets.values.update({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'insumos!A2:F' + (insumos.length + 1),
                    valueInputOption: 'RAW',
                    resource: {
                        values: insumosValues
                    }
                });

                // Actualizar UI
                renderPrestamosTable();
                renderInsumosTable();
                updateDashboard();

                hideLoader();
                showToast('Pr√©stamo marcado como devuelto', 'success');

            } catch (error) {
                console.error('Error al marcar pr√©stamo como devuelto', error);
                hideLoader();
                showToast('Error al marcar pr√©stamo como devuelto', 'error');
            }
        }

        /**
         * Elimina un pr√©stamo
         * @param {number} index - √çndice del pr√©stamo en el array
         */
        async function deletePrestamo(index) {
            const prestamo = prestamos[index];
            if (!prestamo) return;

            if (!confirm(`¬øEst√° seguro de eliminar este pr√©stamo? Esta acci√≥n afectar√° el inventario.`)) {
                return;
            }

            try {
                showLoader();

                // Actualizar inventario si el pr√©stamo est√° activo
                if (prestamo.estado === 'Activo') {
                    if (prestamo.tipo === 'Otorgado') {
                        // Si fue otorgado y est√° activo, al eliminarlo se suma al inventario
                        prestamo.items.forEach(item => {
                            const insumoIndex = insumos.findIndex(i => i.nombre === item.nombre);
                            if (insumoIndex !== -1) {
                                insumos[insumoIndex].cantidad += item.cantidad;
                            }
                        });
                    } else {
                        // Si fue recibido y est√° activo, al eliminarlo se resta del inventario
                        prestamo.items.forEach(item => {
                            const insumoIndex = insumos.findIndex(i => i.nombre === item.nombre);
                            if (insumoIndex !== -1) {
                                insumos[insumoIndex].cantidad -= item.cantidad;
                                // Asegurar que no quede negativo
                                if (insumos[insumoIndex].cantidad < 0) {
                                    insumos[insumoIndex].cantidad = 0;
                                }
                            }
                        });
                    }
                }

                // Eliminar de la lista local
                prestamos.splice(index, 1);

                // Actualizar pr√©stamos en Google Sheets
                const prestamosValues = prestamos.map(prestamo => [
                    prestamo.fecha,
                    prestamo.tipo,
                    prestamo.terminal,
                    prestamo.contacto,
                    JSON.stringify(prestamo.items),
                    prestamo.fechaDevolucion,
                    prestamo.estado
                ]);

                // Si no hay pr√©stamos, limpiar la hoja
                if (prestamosValues.length === 0) {
                    await gapi.client.sheets.spreadsheets.values.clear({
                        spreadsheetId: SPREADSHEET_ID,
                        range: 'prestamos!A2:G'
                    });
                } else {
                    await gapi.client.sheets.spreadsheets.values.update({
                        spreadsheetId: SPREADSHEET_ID,
                        range: 'prestamos!A2:G' + (prestamosValues.length + 1),
                        valueInputOption: 'RAW',
                        resource: {
                            values: prestamosValues
                        }
                    });
                }

                // Actualizar inventario en Google Sheets
                const insumosValues = insumos.map(insumo => [
                    insumo.nombre,
                    insumo.categoria,
                    insumo.cantidad,
                    insumo.ubicacion,
                    insumo.descripcion,
                    insumo.fechaRegistro
                ]);

                await gapi.client.sheets.spreadsheets.values.update({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'insumos!A2:F' + (insumos.length + 1),
                    valueInputOption: 'RAW',
                    resource: {
                        values: insumosValues
                    }
                });

                // Actualizar UI
                renderPrestamosTable();
                renderInsumosTable();
                updateDashboard();

                hideLoader();
                showToast('Pr√©stamo eliminado correctamente', 'success');

            } catch (error) {
                console.error('Error al eliminar pr√©stamo', error);
                hideLoader();
                showToast('Error al eliminar el pr√©stamo', 'error');
            }
        }

        /**
         * Genera una orden para un insumo en bajo stock
         * @param {string} insumoNombre - Nombre del insumo para el que se genera la orden
         */
        function generateOrder(insumoNombre) {
            const insumo = insumos.find(i => i.nombre === insumoNombre);
            if (!insumo) return;

            // Navegar a la secci√≥n de entradas
            showSection('entradas');

            // Seleccionar el men√∫ correspondiente
            menuLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-section') === 'entradas') {
                    link.classList.add('active');
                }
            });

            // Rellenar el formulario
            document.getElementById('entradaTipo').value = 'Compra';
            document.getElementById('entradaFecha').value = new Date().toISOString().split('T')[0];
            document.getElementById('entradaResponsable').value = currentUser.nombre;

            // Agregar el insumo a la lista
            const entradaItems = document.getElementById('entradaItems');
            entradaItems.innerHTML = '';

            const row = document.createElement('div');
            row.className = 'input-row';
            row.innerHTML = `
        <select class="form-control insumo-select" required>
            <option value="${insumo.nombre}" selected>${insumo.nombre}</option>
            ${insumos.filter(i => i.nombre !== insumo.nombre).map(i => `<option value="${i.nombre}">${i.nombre}</option>`).join('')}
        </select>
        <input type="number" class="form-control" placeholder="Cantidad" min="1" value="${10}" required>
        <div class="row-actions">
            <button type="button" class="btn btn-primary btn-add-row"><i class="fas fa-plus"></i></button>
        </div>
    `;

            entradaItems.appendChild(row);

            // Scroll al formulario
            document.getElementById('entradaForm').scrollIntoView({ behavior: 'smooth' });

            showToast(`Se ha preparado una solicitud para el insumo: ${insumo.nombre}`, 'info');
        }

        /**
         * Populate selects with data
         */
        function populateSelects() {
            // Populate insumos
            const insumoSelects = document.querySelectorAll('.insumo-select');
            insumoSelects.forEach(select => {
                const currentValue = select.value;
                select.innerHTML = '<option value="">Seleccionar insumo</option>';

                insumos.forEach(insumo => {
                    const option = document.createElement('option');
                    option.value = insumo.nombre;
                    option.textContent = `${insumo.nombre} (${insumo.cantidad} disponibles)`;
                    select.appendChild(option);
                });

                // Restore selected value if it exists
                if (currentValue && select.querySelector(`option[value="${currentValue}"]`)) {
                    select.value = currentValue;
                }
            });

            // Populate responsables
            const responsableSelects = document.querySelectorAll('#entradaResponsable, #salidaResponsable');
            responsableSelects.forEach(select => {
                const currentValue = select.value;
                select.innerHTML = '<option value="">Seleccionar responsable</option>';

                // Add current user
                if (currentUser) {
                    const option = document.createElement('option');
                    option.value = currentUser.nombre;
                    option.textContent = currentUser.nombre;
                    select.appendChild(option);
                }

                // Add personnel
                personal.forEach(persona => {
                    if (currentUser && persona.nombre === currentUser.nombre) return;

                    const option = document.createElement('option');
                    option.value = persona.nombre;
                    option.textContent = persona.nombre;
                    select.appendChild(option);
                });

                // Restore selected value if it exists
                if (currentValue && select.querySelector(`option[value="${currentValue}"]`)) {
                    select.value = currentValue;
                } else if (currentUser) {
                    select.value = currentUser.nombre;
                }
            });
        }

        /**
         * Muestra un mensaje toast al usuario
         * @param {string} message - Mensaje a mostrar
         * @param {string} type - Tipo de mensaje (success, error, warning, info)
         * @param {number} duration - Duraci√≥n en milisegundos
         */
        function showToast(message, type = 'info', duration = 5000) {
            const toastId = 'toast-' + Date.now();
            const toast = document.createElement('div');
            toast.id = toastId;
            toast.className = `toast toast-${type}`;

            // √çconos para cada tipo de toast
            let icon;
            switch (type) {
                case 'success':
                    icon = '<i class="fas fa-check-circle"></i>';
                    break;
                case 'error':
                    icon = '<i class="fas fa-exclamation-circle"></i>';
                    break;
                case 'warning':
                    icon = '<i class="fas fa-exclamation-triangle"></i>';
                    break;
                default:
                    icon = '<i class="fas fa-info-circle"></i>';
            }

            // T√≠tulo para cada tipo de toast
            let title;
            switch (type) {
                case 'success':
                    title = '√âxito';
                    break;
                case 'error':
                    title = 'Error';
                    break;
                case 'warning':
                    title = 'Advertencia';
                    break;
                default:
                    title = 'Informaci√≥n';
            }

            toast.innerHTML = `
        <div class="toast-icon">
            ${icon}
        </div>
        <div class="toast-content">
            <div class="toast-title">${title}</div>
            <div class="toast-message">${message}</div>
        </div>
        <button class="toast-close" onclick="closeToast('${toastId}')">
            <i class="fas fa-times"></i>
        </button>
        <div class="toast-progress">
            <div class="toast-progress-bar"></div>
        </div>
    `;

            toastContainer.appendChild(toast);

            // Auto-cerrar despu√©s del tiempo especificado
            setTimeout(() => {
                closeToast(toastId);
            }, duration);
        }

        /**
         * Cierra un toast espec√≠fico
         * @param {string} toastId - ID del toast a cerrar
         */
        function closeToast(toastId) {
            const toast = document.getElementById(toastId);
            if (!toast) return;

            toast.classList.add('removing');
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 300);
        }

        /**
         * Formatea una fecha para mostrar
         * @param {string|Date} date - Fecha a formatear
         * @returns {string} Fecha formateada
         */
        function formatDate(date) {
            if (!date) return '';

            const d = new Date(date);
            if (isNaN(d.getTime())) return date;

            const day = String(d.getDate()).padStart(2, '0');
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const year = d.getFullYear();

            return `${day}/${month}/${year}`;
        }

        /**
         * Muestra el loader
         */
        function showLoader() {
            loader.style.display = 'flex';
        }

        /**
         * Oculta el loader
         */
        function hideLoader() {
            loader.style.display = 'none';
        }

        // Export functions to global scope for HTML event handlers
        window.showSection = showSection;
        window.closeToast = closeToast;
        window.editInsumo = editInsumo;
        window.deleteInsumo = deleteInsumo;
        window.editPersonal = editPersonal;
        window.deletePersonal = deletePersonal;
        window.viewEntrada = viewEntrada;
        window.deleteEntrada = deleteEntrada;
        window.viewSalida = viewSalida;
        window.deleteSalida = deleteSalida;
        window.viewPrestamo = viewPrestamo;
        window.returnPrestamo = returnPrestamo;
        window.deletePrestamo = deletePrestamo;
        window.generateOrder = generateOrder;

    </script>